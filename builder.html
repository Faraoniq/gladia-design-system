<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Page Builder — Gladia</title>
  <style>
    @font-face { font-family: 'Suisse Intl'; src: url('fonts/SuisseIntl-Regular.woff2') format('woff2'), url('fonts/SuisseIntl-Regular.woff') format('woff'); font-weight: 400; font-style: normal; font-display: swap; }
    @font-face { font-family: 'Suisse Intl'; src: url('fonts/SuisseIntl-Book.woff2') format('woff2'), url('fonts/SuisseIntl-Book.woff') format('woff'); font-weight: 450; font-style: normal; font-display: swap; }
    @font-face { font-family: 'Suisse Intl'; src: url('fonts/SuisseIntl-Medium.woff2') format('woff2'), url('fonts/SuisseIntl-Medium.woff') format('woff'); font-weight: 500; font-style: normal; font-display: swap; }
    @font-face { font-family: 'Suisse Intl'; src: url('fonts/SuisseIntl-SemiBold.woff2') format('woff2'), url('fonts/SuisseIntl-SemiBold.woff') format('woff'); font-weight: 600; font-style: normal; font-display: swap; }
  </style>
  <style>
    :root {
      --color-neutral-0:#FFFFFF;--color-neutral-50:#FAFAFA;--color-neutral-100:#F5F5F5;--color-neutral-200:#E5E5E5;--color-neutral-300:#D4D4D4;--color-neutral-400:#A3A3A3;--color-neutral-500:#727272;--color-neutral-600:#515151;--color-neutral-700:#252525;--color-neutral-800:#1C1C1E;--color-neutral-900:#0C0C0C;--color-neutral-1000:#000000;
      --color-purple-100:#EDE9FE;--color-purple-200:#BEB4FF;--color-purple-300:#A87CFF;--color-purple-400:#947AFC;--color-purple-500:#925BFF;--color-purple-600:#7C3AED;--color-purple-700:#6D28D9;
      --color-blue-100:#BAE0FF;--color-blue-200:#7EC8FF;--color-blue-300:#45B0FF;--color-blue-400:#1A9EFF;--color-blue-500:#008CFF;--color-blue-600:#0070CC;--color-blue-700:#005499;
      --color-green-100:#DCFCE7;--color-green-500:#22C55E;--color-green-600:#16A34A;
      --color-red-100:#FEE2E2;--color-red-500:#EF4444;--color-red-600:#DC2626;
      --color-yellow-100:#FEF9C3;--color-yellow-400:#F2CB45;--color-yellow-500:#EAB308;
      --color-orange-500:#FF630F;--color-pink-400:#FF5FB0;
      --color-purple:var(--color-purple-400);--color-blue:var(--color-blue-500);--color-orange:var(--color-orange-500);--color-yellow:var(--color-yellow-400);--color-pink:var(--color-pink-400);
      --space-0:0px;--space-1:8px;--space-2:16px;--space-3:24px;--space-4:32px;--space-5:40px;--space-6:48px;--space-7:56px;--space-8:64px;--space-9:72px;--space-10:80px;--space-12:96px;--space-14:112px;--space-15:120px;--space-16:128px;--space-20:160px;--space-24:192px;
      --radius-0:0px;--radius-1:8px;--radius-2:16px;--radius-3:24px;--radius-4:32px;--radius-5:40px;--radius-6:48px;--radius-full:9999px;
      --shadow-none:none;--shadow-sm:0 1px 2px 0 rgba(0,0,0,0.05);--shadow-md:0 4px 8px -2px rgba(0,0,0,0.1);--shadow-lg:0 8px 16px -4px rgba(0,0,0,0.1);--shadow-xl:0 16px 32px -8px rgba(0,0,0,0.15);
      --font-sans:'Suisse Intl','Inter',-apple-system,BlinkMacSystemFont,sans-serif;--font-mono:'Geist Mono','JetBrains Mono',monospace;
      --font-size-10:10px;--font-size-12:12px;--font-size-14:14px;--font-size-16:16px;--font-size-18:18px;--font-size-20:20px;--font-size-24:24px;--font-size-32:32px;--font-size-40:40px;--font-size-48:48px;--font-size-56:56px;--font-size-60:60px;--font-size-64:64px;--font-size-80:80px;
      --font-weight-regular:400;--font-weight-book:450;--font-weight-medium:500;--font-weight-semibold:600;
      --line-height-none:1;--line-height-tight:1.2;--line-height-snug:1.3;--line-height-normal:1.4;--line-height-relaxed:1.5;--line-height-loose:1.6;
      --letter-spacing-tighter:-0.04em;--letter-spacing-tight:-0.02em;--letter-spacing-normal:0;--letter-spacing-wide:0.02em;--letter-spacing-wider:0.08em;--letter-spacing-widest:0.16em;
      --duration-0:0ms;--duration-1:80ms;--duration-2:160ms;--duration-3:240ms;--duration-4:320ms;--duration-5:480ms;
      --easing-linear:linear;--easing-in:cubic-bezier(0.4,0,1,1);--easing-out:cubic-bezier(0,0,0.2,1);--easing-in-out:cubic-bezier(0.4,0,0.2,1);--easing-spring:cubic-bezier(0.34,1.56,0.64,1);
      --text-primary:var(--color-neutral-0);--text-secondary:var(--color-neutral-400);--text-tertiary:var(--color-neutral-500);--text-disabled:var(--color-neutral-400);--text-inverse:var(--color-neutral-1000);--text-link:var(--color-neutral-300);--text-brand:var(--color-purple-400);--text-success:var(--color-green-600);--text-warning:var(--color-yellow-500);--text-error:var(--color-red-600);
      --bg-primary:var(--color-neutral-1000);--bg-secondary:var(--color-neutral-900);--bg-tertiary:var(--color-neutral-800);--bg-inverse:var(--color-neutral-0);--bg-elevated:var(--color-neutral-700);--bg-sunken:var(--color-neutral-900);--bg-glass:rgba(12,12,12,0.8);--bg-glass-light:rgba(255,255,255,0.08);--bg-brand:var(--color-purple-400);
      --border-primary:var(--color-neutral-700);--border-secondary:var(--color-neutral-600);--border-tertiary:var(--color-neutral-800);--border-card:var(--border-primary);--border-transparent:rgba(255,255,255,0.12);--border-transparent-subtle:rgba(255,255,255,0.08);--border-focus:var(--color-blue-400);--border-brand:var(--color-purple-400);
      --container-max-width:1200px;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{font-size:16px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    body{font-family:var(--font-sans);background-color:var(--bg-primary);color:var(--text-primary);line-height:var(--line-height-normal)}
    img{max-width:100%;height:auto;display:block}
    h1,h2,h3,h4,h5,h6{font-weight:inherit}
    a{color:inherit;text-decoration:none}
    button{font-family:inherit;cursor:pointer}

    @keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

    /* Layout */
    .container{max-width:var(--container-max-width);padding-left:var(--space-3);padding-right:var(--space-3);margin:0 auto}
    .section{padding:var(--space-8) 0;background:var(--bg-primary)}

    /* Navbar */
    .navbar{position:fixed;top:var(--space-3);left:50%;transform:translateX(-50%);width:calc(100% - var(--space-6));max-width:var(--container-max-width);height:var(--space-9);background:var(--bg-glass);border:1px solid var(--border-transparent-subtle);border-radius:var(--radius-3);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:100}
    .navbar-inner{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:0 var(--space-3);height:100%}
    .navbar-logo{display:flex;align-items:center;gap:var(--space-1)}
    .navbar-logo svg{height:28px;width:auto}
    .navbar-links{display:flex;align-items:center;gap:var(--space-3)}
    .navbar-links a,.navbar-links button{font-size:var(--font-size-14);color:var(--text-secondary);transition:color var(--duration-2) var(--easing-out);background:none;border:none;font-family:var(--font-sans);cursor:pointer;padding:0}
    .navbar-links a:hover,.navbar-links button:hover{color:var(--text-primary)}
    .navbar-actions{display:flex;align-items:center;gap:var(--space-2);justify-self:end}

    /* Mega Menu */
    .mega-menu{position:absolute;top:100%;left:0;right:0;background:var(--bg-glass);border:1px solid var(--border-transparent-subtle);border-radius:var(--radius-3);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);margin-top:8px;opacity:0;visibility:hidden;transform:translateY(-8px);transition:opacity 0.25s var(--easing-out),transform 0.25s var(--easing-out),visibility 0.25s;z-index:200;overflow:hidden}
    .mega-menu.is-visible{opacity:1;visibility:visible;transform:translateY(0)}
    .mega-menu-bridge{position:absolute;bottom:100%;left:0;right:0;height:16px}
    .mega-menu-panel{display:none;padding:var(--space-4)}
    .mega-menu-panel.is-visible{display:grid;grid-template-columns:1fr 1fr 1fr 280px;gap:var(--space-3)}
    .mega-menu-col{display:flex;flex-direction:column;gap:var(--space-1)}
    .mega-menu-col-title{font-size:var(--font-size-10);font-weight:var(--font-weight-medium);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:var(--letter-spacing-widest);color:var(--text-tertiary);padding:var(--space-1) var(--space-2);margin-bottom:var(--space-1)}
    .mega-menu-item{display:flex;align-items:flex-start;gap:var(--space-2);padding:var(--space-2);border-radius:var(--radius-2);transition:background var(--duration-2) var(--easing-out);text-decoration:none}
    .mega-menu-item:hover{background:var(--bg-glass-light)}
    .mega-menu-item-icon{width:32px;height:32px;border-radius:var(--radius-1);background:var(--bg-tertiary);display:flex;align-items:center;justify-content:center;flex-shrink:0;color:var(--color-purple-400);font-size:16px}
    .mega-menu-item-text{display:flex;flex-direction:column;gap:2px}
    .mega-menu-item-title{font-size:var(--font-size-14);font-weight:var(--font-weight-medium);color:var(--text-primary)}
    .mega-menu-item-desc{font-size:var(--font-size-12);color:var(--text-tertiary);line-height:var(--line-height-relaxed)}
    .mega-menu-featured{background:var(--bg-secondary);border-radius:var(--radius-2);padding:var(--space-3);display:flex;flex-direction:column;gap:var(--space-2)}
    .mega-menu-featured-title{font-size:var(--font-size-10);font-weight:var(--font-weight-medium);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:var(--letter-spacing-widest);color:var(--text-tertiary)}
    .mega-menu-featured-card{display:flex;flex-direction:column;gap:var(--space-1);padding:var(--space-2);border-radius:var(--radius-1);transition:background var(--duration-2) var(--easing-out);text-decoration:none}
    .mega-menu-featured-card:hover{background:var(--bg-glass-light)}
    .mega-menu-featured-card-title{font-size:var(--font-size-14);font-weight:var(--font-weight-medium);color:var(--text-primary)}
    .mega-menu-featured-card-desc{font-size:var(--font-size-12);color:var(--text-tertiary);line-height:var(--line-height-relaxed)}

    /* Buttons */
    .btn{display:inline-flex;align-items:center;justify-content:center;border:none;border-radius:var(--radius-5);font-family:var(--font-sans);cursor:pointer;transition:transform var(--duration-2) var(--easing-out);text-decoration:none;white-space:nowrap}
    .btn:hover{transform:scale(1.02)}
    .btn-xs{height:28px;padding:4px 12px;font-size:var(--font-size-12);font-weight:var(--font-weight-book)}
    .btn-sm{height:32px;padding:6px 16px;font-size:var(--font-size-14);font-weight:var(--font-weight-book)}
    .btn-md{height:40px;padding:8px 20px;font-size:var(--font-size-14);font-weight:var(--font-weight-book)}
    .btn-lg{height:48px;padding:12px 28px;font-size:var(--font-size-16);font-weight:var(--font-weight-medium)}
    .btn-primary{background:var(--bg-inverse);color:var(--text-inverse)}
    .btn-secondary{background:transparent;color:var(--text-primary);border:1px solid var(--border-transparent)}
    .btn-ghost{background:transparent;color:var(--text-primary);border:none}
    .btn-ghost:hover{background:var(--bg-glass-light)}
    .btn-text-wrapper{display:block;position:relative;overflow:hidden}
    .btn-text{display:block;transition:transform 0.3s var(--easing-in-out)}
    .btn-text-clone{position:absolute;top:0;left:0;width:100%;transform:translateY(100%);transition:transform 0.3s var(--easing-in-out)}
    .btn:hover .btn-text{transform:translateY(-100%)}
    .btn:hover .btn-text-clone{transform:translateY(0)}

    /* Tag */
    .tag-label{display:inline-flex;align-items:center;gap:var(--space-2)}
    .tag-indicator{width:16px;height:8px;background:var(--color-purple-400);border-radius:var(--radius-full)}
    .tag-text{font-size:var(--font-size-12);font-weight:var(--font-weight-medium);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:var(--letter-spacing-widest);color:var(--color-purple-400)}

    /* Bento A */
    .bento-a{display:grid;grid-template-columns:1fr 1fr;gap:var(--space-2);min-height:calc(100vh - var(--space-20))}
    .b__card{background:var(--bg-primary);border:1px solid var(--border-card);border-radius:var(--radius-3);overflow:hidden;transition:border-color var(--duration-2) var(--easing-out)}
    .b__card:hover{border-color:var(--border-secondary)}
    .b__hero-overlay{position:relative;display:flex;flex-direction:column;min-height:100%}
    .b__hero-overlay .b__hero-content{position:absolute;top:0;left:0;right:0;padding:var(--space-5) var(--space-4);z-index:2}
    .b__hero-overlay .b__hero-visual{position:absolute;inset:0;min-height:0}
    .b__hero-overlay .b__hero-visual::after{content:'';position:absolute;inset:0;z-index:1;background:linear-gradient(180deg,rgba(0,0,0,0.72) 0%,rgba(0,0,0,0.35) 40%,rgba(0,0,0,0.10) 70%,rgba(0,0,0,0.45) 100%)}
    .b__hero-overlay .b__hero-subtitle{color:rgba(255,255,255,0.7)}
    .b__hero-stacked{display:flex;flex-direction:column;min-height:100%}
    .b__hero-stacked .b__hero-content{padding:var(--space-5) var(--space-4)}
    .b__hero-stacked .b__hero-visual{min-height:0}
    .b__hero-stacked .b__hero-visual::after{display:none}
    .b__hero-stacked .b__cta{position:relative;bottom:auto;left:auto;margin:0 var(--space-4) var(--space-4);align-self:flex-start}
    .b__hero-title{font-size:var(--font-size-40);font-weight:var(--font-weight-regular);line-height:var(--line-height-tight);letter-spacing:var(--letter-spacing-tight);color:var(--text-primary);margin-bottom:var(--space-2)}
    .b__hero-subtitle{font-size:var(--font-size-16);line-height:var(--line-height-relaxed);color:var(--text-secondary)}
    .b__hero-visual{flex:1;position:relative;overflow:hidden;min-height:300px;background:var(--bg-secondary)}
    .b__cta{position:absolute;bottom:var(--space-4);left:var(--space-4);z-index:3;display:inline-flex;align-items:center;height:40px;padding:0 var(--space-3);background:var(--bg-inverse);color:var(--text-inverse);border:none;border-radius:var(--radius-5);font-size:var(--font-size-14);font-weight:var(--font-weight-book);font-family:var(--font-sans);cursor:pointer;transition:transform var(--duration-2) var(--easing-out),box-shadow var(--duration-2) var(--easing-out);text-decoration:none}
    .b__cta:hover{transform:scale(1.02);box-shadow:0 8px 24px -8px rgba(0,0,0,0.4)}
    .b__cta:hover .btn-text{transform:translateY(-100%)}
    .b__cta:hover .btn-text-clone{transform:translateY(0)}
    .b__features{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr}
    .b__cell{padding:var(--space-4);display:flex;flex-direction:column}
    .b__cell:nth-child(odd){border-right:1px solid var(--border-primary)}
    .b__cell:nth-child(-n+2){border-bottom:1px solid var(--border-primary)}
    .b__cell-icon{width:48px;height:48px;border-radius:var(--radius-full);background:var(--bg-tertiary);display:flex;align-items:center;justify-content:center;margin-bottom:var(--space-3);flex-shrink:0}
    .b__cell-icon svg{width:20px;height:20px;stroke:var(--text-primary);fill:none}
    .b__cell-title{font-size:var(--font-size-20);font-weight:var(--font-weight-regular);line-height:var(--line-height-snug);color:var(--text-primary);margin-bottom:var(--space-1)}
    .b__cell-desc{font-size:var(--font-size-16);line-height:var(--line-height-relaxed);color:var(--text-secondary)}
    .bento-a--inv{direction:rtl}
    .bento-a--inv>*{direction:ltr}

    /* Bento B */
    .bento-b{display:grid;grid-template-rows:1fr auto;gap:var(--space-2);min-height:calc(100vh - var(--space-20))}
    .bento-b .b__hero-visual{min-height:360px}
    .bento-b .b__features{grid-template-columns:repeat(3,1fr);grid-template-rows:1fr}
    .bento-b .b__cell{border-bottom:none}
    .bento-b .b__cell:nth-child(odd){border-right:none}
    .bento-b .b__cell:not(:last-child){border-right:1px solid var(--border-primary)}

    /* Bento 1x1 */
    .bento-1x1{display:block}
    .bento-1x1 .b__card{position:relative;min-height:540px}
    .bento-1x1 .b__hero-overlay{min-height:540px;display:flex;align-items:center;justify-content:center}
    .bento-1x1 .b__hero-content{position:relative;top:auto;left:auto;right:auto;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--space-6)}
    .bento-1x1 .b__hero-visual{min-height:540px}
    .bento-1x1 .b__cta{position:relative;bottom:auto;left:auto;margin-top:var(--space-4)}

    .b--animated{animation:fadeInUp 0.8s var(--easing-out) forwards}
    .b--animated .b__features{opacity:0;animation:fadeInUp 0.8s var(--easing-out) 0.25s forwards}
    .b--animated .b__cell:nth-child(1){opacity:0;animation:fadeInUp 0.6s var(--easing-out) 0.3s forwards}
    .b--animated .b__cell:nth-child(2){opacity:0;animation:fadeInUp 0.6s var(--easing-out) 0.4s forwards}
    .b--animated .b__cell:nth-child(3){opacity:0;animation:fadeInUp 0.6s var(--easing-out) 0.5s forwards}
    .b--animated .b__cell:nth-child(4){opacity:0;animation:fadeInUp 0.6s var(--easing-out) 0.6s forwards}


    /* Hero */
    .hero-section{position:relative;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:var(--space-20) var(--space-3) var(--space-15);overflow:hidden;text-align:center}
    .hero-section-bg{position:absolute;inset:0;overflow:hidden;z-index:0}
    .hero-section-bg-blob{position:absolute;border-radius:50%;filter:blur(120px);opacity:0.35;animation:heroFloat 12s ease-in-out infinite alternate}
    .hero-section-bg-blob:nth-child(1){width:500px;height:500px;background:var(--color-purple-500);top:-10%;left:20%}
    .hero-section-bg-blob:nth-child(2){width:400px;height:400px;background:var(--color-blue-500);top:30%;right:10%;animation-delay:-4s}
    .hero-section-bg-blob:nth-child(3){width:350px;height:350px;background:var(--color-purple-300);bottom:0;left:40%;animation-delay:-8s}
    @keyframes heroFloat{0%{transform:translate(0,0) scale(1)}100%{transform:translate(30px,-20px) scale(1.1)}}
    .hero-section-content{position:relative;z-index:2;max-width:860px;animation:fadeInUp 0.8s var(--easing-out) forwards}
    .hero-section h1{font-size:var(--font-size-80);font-weight:var(--font-weight-regular);line-height:var(--line-height-tight);letter-spacing:var(--letter-spacing-tighter);margin-bottom:var(--space-3)}
    .hero-section-subtitle{font-size:var(--font-size-18);color:var(--text-secondary);line-height:var(--line-height-relaxed);max-width:640px;margin:0 auto var(--space-5)}
    .hero-section-actions{display:flex;gap:var(--space-2);justify-content:center;flex-wrap:wrap}
    .hero-section-badge{display:inline-flex;align-items:center;gap:var(--space-1);padding:4px 12px;border:1px solid var(--border-transparent);border-radius:var(--radius-full);font-size:var(--font-size-12);color:var(--text-secondary);margin-bottom:var(--space-4);backdrop-filter:blur(8px);background:var(--bg-glass-light)}
    .hero-section-badge-new{font-size:var(--font-size-10);font-weight:var(--font-weight-semibold);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:var(--letter-spacing-wider);color:var(--color-purple-400);background:rgba(148,122,252,0.15);padding:2px 6px;border-radius:var(--radius-full)}

    /* Text + Media */
    .text-media{padding:var(--space-10) 0}
    .text-media-grid{display:grid;grid-template-columns:1fr 1fr;gap:var(--space-6);align-items:center}
    .text-media-grid--inv{direction:rtl}
    .text-media-grid--inv>*{direction:ltr}
    .text-media-content{display:flex;flex-direction:column;gap:var(--space-3)}
    .text-media-title{font-size:var(--font-size-40);font-weight:var(--font-weight-medium);line-height:var(--line-height-snug);letter-spacing:var(--letter-spacing-tight);color:var(--text-primary)}
    .text-media-subtitle{font-size:var(--font-size-18);line-height:var(--line-height-relaxed);color:var(--text-secondary)}
    .text-media-visual{aspect-ratio:1/1;background:var(--color-neutral-100);border-radius:var(--radius-3);overflow:hidden}

    /* List + Media */
    .list-media{padding:var(--space-10) 0}
    .list-media-heading{font-size:var(--font-size-40);font-weight:var(--font-weight-medium);line-height:var(--line-height-snug);letter-spacing:var(--letter-spacing-tight);color:var(--text-primary);margin-bottom:var(--space-6)}
    .list-media-grid{display:grid;grid-template-columns:1fr 1fr;gap:var(--space-6);align-items:start}
    .list-media-grid--inv{direction:rtl}
    .list-media-grid--inv>*{direction:ltr}
    .list-media-items{display:flex;flex-direction:column}
    .list-media-item{padding:var(--space-4) 0;border-bottom:1px solid var(--border-primary)}
    .list-media-item:first-child{padding-top:0}
    .list-media-item-title{display:flex;align-items:center;gap:var(--space-2);font-size:var(--font-size-24);font-weight:var(--font-weight-medium);color:var(--text-primary);margin-bottom:var(--space-1)}
    .list-media-item-indicator{width:12px;height:6px;background:var(--color-purple-400);border-radius:var(--radius-full);flex-shrink:0}
    .list-media-item-desc{font-size:var(--font-size-16);line-height:var(--line-height-relaxed);color:var(--text-secondary);padding-left:20px}
    .list-media-visual{aspect-ratio:1/1;background:var(--color-neutral-100);border-radius:var(--radius-3);overflow:hidden}

    /* Related */
    .related-section{padding:var(--space-10) 0;text-align:center}
    .related-heading{font-size:var(--font-size-40);font-weight:var(--font-weight-medium);line-height:var(--line-height-snug);letter-spacing:var(--letter-spacing-tight);color:var(--text-primary);margin-bottom:var(--space-6)}
    .related-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--space-4);text-align:left}
    .related-card{display:flex;flex-direction:column;gap:var(--space-3)}
    .related-card-image{aspect-ratio:3/2;background:var(--color-neutral-100);border-radius:var(--radius-3);overflow:hidden}
    .related-card-title{font-size:var(--font-size-24);font-weight:var(--font-weight-medium);line-height:var(--line-height-snug);color:var(--text-primary)}
    .related-card-desc{font-size:var(--font-size-16);line-height:var(--line-height-relaxed);color:var(--text-secondary)}

    /* Section common */
    .section-title{font-size:var(--font-size-40);font-weight:var(--font-weight-medium);line-height:var(--line-height-snug);letter-spacing:var(--letter-spacing-tight);margin-bottom:var(--space-2)}
    .section-subtitle{font-size:var(--font-size-18);color:var(--text-secondary);line-height:var(--line-height-relaxed);margin-bottom:var(--space-5)}

    /* Statement */
    .statement-section{padding:var(--space-8) 0;text-align:center}
    .statement-text{max-width:900px;margin:0 auto}
    .statement-title{font-size:var(--font-size-40);font-weight:var(--font-weight-medium);line-height:var(--line-height-snug);letter-spacing:var(--letter-spacing-tight);color:var(--text-primary);margin-bottom:var(--space-3)}
    .statement-body{font-size:var(--font-size-24);font-weight:var(--font-weight-regular);line-height:var(--line-height-relaxed);color:var(--text-secondary)}

    /* CTA Section */
    .cta-section{padding:var(--space-8) 0;background:var(--bg-primary);text-align:center}
    .cta-content{max-width:600px;margin:0 auto}
    .cta-title{font-size:var(--font-size-40);font-weight:var(--font-weight-medium);line-height:var(--line-height-snug);letter-spacing:var(--letter-spacing-tight);margin-bottom:var(--space-2)}
    .cta-subtitle{font-size:var(--font-size-18);color:var(--text-secondary);margin-bottom:var(--space-5)}
    .cta-actions{display:flex;gap:var(--space-2);justify-content:center;flex-wrap:wrap}

    /* Footer */
    .footer{background:var(--bg-primary);border-top:1px solid var(--border-primary);padding:var(--space-9) 0 var(--space-8)}
    .footer-top{display:flex;gap:var(--space-2);margin-bottom:var(--space-8)}
    .footer-brand{flex:2}
    .footer-brand-desc{font-size:var(--font-size-14);color:var(--text-tertiary);line-height:var(--line-height-relaxed);max-width:280px;margin-top:var(--space-2)}
    .footer-columns{flex:3;display:flex;gap:var(--space-2)}
    .footer-column{flex:1;display:flex;flex-direction:column;gap:var(--space-2)}
    .footer-column-title{font-size:var(--font-size-14);font-weight:var(--font-weight-medium);color:var(--text-primary);margin-bottom:var(--space-1)}
    .footer-column a{font-size:var(--font-size-14);color:var(--text-tertiary);transition:color var(--duration-2) var(--easing-out)}
    .footer-column a:hover{color:var(--text-primary)}
    .footer-bottom{padding-top:var(--space-6);border-top:1px solid var(--border-primary);display:flex;align-items:center;justify-content:space-between}
    .footer-bottom-text{font-size:var(--font-size-12);color:var(--text-tertiary)}
    .footer-bottom-links{display:flex;gap:var(--space-3)}
    .footer-bottom-links a{font-size:var(--font-size-12);color:var(--text-tertiary);transition:color var(--duration-2) var(--easing-out)}
    .footer-bottom-links a:hover{color:var(--text-primary)}

    /* ========== BUILDER UI ========== */
    .builder-app{display:grid;grid-template-columns:340px 1fr;grid-template-rows:56px 1fr;height:100vh;overflow:hidden}
    .builder-topbar{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;padding:0 var(--space-3);background:var(--bg-secondary);border-bottom:1px solid var(--border-primary)}
    .builder-topbar-left{display:flex;align-items:center;gap:var(--space-2)}
    .builder-topbar-title{font-size:var(--font-size-14);font-weight:var(--font-weight-medium);color:var(--text-primary)}
    .builder-topbar-badge{font-size:var(--font-size-10);font-weight:var(--font-weight-medium);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:var(--letter-spacing-wider);color:var(--color-purple-400);background:rgba(148,122,252,0.12);border:1px solid rgba(148,122,252,0.25);padding:2px 8px;border-radius:var(--radius-full)}
    .builder-topbar-right{display:flex;align-items:center;gap:var(--space-2)}
    .builder-scope-toggle{display:flex;background:var(--bg-tertiary);border-radius:var(--radius-1);padding:2px}
    .builder-scope-btn{padding:4px 10px;border:none;background:transparent;color:var(--text-tertiary);font-size:var(--font-size-12);font-weight:var(--font-weight-medium);font-family:var(--font-sans);border-radius:6px;cursor:pointer;transition:all var(--duration-2) var(--easing-out)}
    .builder-scope-btn.is-active{background:var(--color-neutral-700);color:var(--text-primary)}
    .builder-export-btn{display:inline-flex;align-items:center;gap:6px;height:32px;padding:0 14px;background:var(--bg-inverse);color:var(--text-inverse);border:none;border-radius:var(--radius-full);font-size:var(--font-size-12);font-weight:var(--font-weight-medium);font-family:var(--font-sans);cursor:pointer;transition:transform var(--duration-2) var(--easing-out)}
    .builder-export-btn:hover{transform:scale(1.03)}
    .builder-export-btn.is-copied{background:var(--color-green-500);color:white}

    /* Sidebar */
    .builder-sidebar{background:var(--bg-secondary);border-right:1px solid var(--border-primary);overflow-y:auto;padding:var(--space-3);display:flex;flex-direction:column;gap:var(--space-3)}
    .builder-sidebar::-webkit-scrollbar{width:6px}
    .builder-sidebar::-webkit-scrollbar-track{background:transparent}
    .builder-sidebar::-webkit-scrollbar-thumb{background:var(--color-neutral-700);border-radius:3px}
    .builder-group{display:flex;flex-direction:column;gap:var(--space-1)}
    .builder-group-title{font-size:var(--font-size-10);font-weight:var(--font-weight-medium);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:var(--letter-spacing-widest);color:var(--text-tertiary);margin-bottom:4px}
    .builder-label{font-size:var(--font-size-12);color:var(--text-secondary);font-weight:var(--font-weight-medium);margin-bottom:4px}
    .builder-comp-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
    .builder-comp-btn{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px 4px;background:var(--bg-tertiary);border:2px solid transparent;border-radius:var(--radius-1);cursor:pointer;transition:border-color var(--duration-2) var(--easing-out),background var(--duration-2) var(--easing-out)}
    .builder-comp-btn:hover{background:var(--bg-elevated)}
    .builder-comp-btn.is-active{border-color:var(--color-purple-400);background:rgba(148,122,252,0.08)}
    .builder-comp-icon{width:40px;height:28px;display:flex;gap:2px}
    .builder-comp-icon>div{background:var(--color-neutral-600);border-radius:2px;flex:1}
    .builder-comp-label{font-size:9px;font-weight:var(--font-weight-medium);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:0.06em;color:var(--text-tertiary)}
    .builder-comp-btn.is-active .builder-comp-label{color:var(--color-purple-400)}
    .builder-toggle-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0}
    .builder-toggle-label{font-size:var(--font-size-14);color:var(--text-primary)}
    .builder-toggle{position:relative;width:36px;height:20px}
    .builder-toggle input{opacity:0;width:0;height:0;position:absolute}
    .builder-toggle-track{position:absolute;inset:0;background:var(--color-neutral-700);border-radius:10px;cursor:pointer;transition:background var(--duration-2) var(--easing-out)}
    .builder-toggle-track::after{content:'';position:absolute;top:2px;left:2px;width:16px;height:16px;background:var(--color-neutral-300);border-radius:50%;transition:transform var(--duration-2) var(--easing-out)}
    .builder-toggle input:checked+.builder-toggle-track{background:var(--color-purple-400)}
    .builder-toggle input:checked+.builder-toggle-track::after{transform:translateX(16px);background:white}
    .builder-toggle input:disabled+.builder-toggle-track{opacity:0.3;cursor:not-allowed}
    .builder-segment{display:flex;background:var(--bg-tertiary);border-radius:var(--radius-1);padding:2px}
    .builder-segment-btn{flex:1;padding:6px 8px;border:none;background:transparent;color:var(--text-tertiary);font-size:var(--font-size-12);font-weight:var(--font-weight-medium);font-family:var(--font-sans);border-radius:6px;cursor:pointer;transition:all var(--duration-2) var(--easing-out)}
    .builder-segment-btn.is-active{background:var(--color-neutral-700);color:var(--text-primary)}
    .builder-input,.builder-textarea{width:100%;padding:8px 12px;background:var(--bg-tertiary);border:1px solid var(--border-primary);border-radius:var(--radius-1);color:var(--text-primary);font-size:var(--font-size-14);font-family:var(--font-sans);line-height:var(--line-height-normal);transition:border-color var(--duration-2) var(--easing-out)}
    .builder-input:focus,.builder-textarea:focus{outline:none;border-color:var(--color-purple-400)}
    .builder-input::placeholder,.builder-textarea::placeholder{color:var(--text-tertiary)}
    .builder-textarea{resize:vertical;min-height:60px}
    .builder-cell-group{background:var(--bg-tertiary);border:1px solid var(--border-primary);border-radius:var(--radius-1);padding:var(--space-2);display:flex;flex-direction:column;gap:8px}
    .builder-cell-header{display:flex;align-items:center;justify-content:space-between}
    .builder-cell-num{font-size:var(--font-size-10);font-weight:var(--font-weight-semibold);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:var(--letter-spacing-wider);color:var(--text-tertiary)}
    .builder-cell-icon-picker{display:flex;gap:4px}
    .builder-icon-btn{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:var(--bg-secondary);border:1px solid transparent;border-radius:6px;cursor:pointer;color:var(--text-tertiary);transition:all var(--duration-2) var(--easing-out)}
    .builder-icon-btn:hover{color:var(--text-primary)}
    .builder-icon-btn.is-active{border-color:var(--color-purple-400);color:var(--color-purple-400)}
    .builder-icon-btn svg{width:14px;height:14px;stroke:currentColor;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
    .builder-cell-group .builder-input{background:var(--bg-secondary);border-color:var(--border-tertiary)}
    .builder-divider{height:1px;background:var(--border-primary);margin:4px 0}

    /* Section list */
    .builder-section-list{display:flex;flex-direction:column;gap:4px}
    .builder-section-pill{display:flex;align-items:center;gap:8px;padding:8px 10px;background:var(--bg-tertiary);border:2px solid transparent;border-radius:var(--radius-1);cursor:pointer;transition:all var(--duration-2) var(--easing-out);user-select:none}
    .builder-section-pill:hover{background:var(--bg-elevated)}
    .builder-section-pill.is-selected{border-color:var(--color-purple-400);background:rgba(148,122,252,0.08)}
    .builder-section-pill-type{font-size:9px;font-family:var(--font-mono);text-transform:uppercase;letter-spacing:0.06em;color:var(--text-tertiary);flex-shrink:0}
    .builder-section-pill-label{flex:1;font-size:var(--font-size-12);font-weight:var(--font-weight-medium);color:var(--text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .builder-pill-actions{display:flex;gap:2px;flex-shrink:0}
    .builder-pill-btn{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:transparent;border:none;border-radius:4px;color:var(--text-tertiary);cursor:pointer;transition:all var(--duration-2) var(--easing-out);font-size:12px;padding:0}
    .builder-pill-btn:hover{background:var(--bg-elevated);color:var(--text-primary)}
    .builder-pill-btn.is-danger:hover{color:var(--color-red-500)}
    .builder-add-section-btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:8px;background:transparent;border:1px dashed var(--border-primary);border-radius:var(--radius-1);color:var(--text-tertiary);font-size:var(--font-size-12);font-weight:var(--font-weight-medium);font-family:var(--font-sans);cursor:pointer;transition:all var(--duration-2) var(--easing-out)}
    .builder-add-section-btn:hover{border-color:var(--color-purple-400);color:var(--color-purple-400);background:rgba(148,122,252,0.04)}

    /* Type picker */
    .builder-type-picker{display:none;flex-direction:column;gap:4px;padding:8px;background:var(--bg-tertiary);border:1px solid var(--border-primary);border-radius:var(--radius-1);margin-top:4px}
    .builder-type-picker.is-open{display:flex}
    .builder-type-btn{display:flex;align-items:center;gap:8px;padding:8px 10px;background:transparent;border:none;border-radius:6px;color:var(--text-primary);font-size:var(--font-size-12);font-weight:var(--font-weight-medium);font-family:var(--font-sans);cursor:pointer;transition:background var(--duration-2) var(--easing-out);text-align:left;width:100%}
    .builder-type-btn:hover{background:var(--bg-elevated)}
    .builder-type-btn-icon{width:28px;height:28px;border-radius:6px;background:var(--bg-secondary);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
    .builder-type-btn-text{display:flex;flex-direction:column;gap:1px}
    .builder-type-btn-name{font-size:var(--font-size-12);color:var(--text-primary)}
    .builder-type-btn-desc{font-size:10px;color:var(--text-tertiary);font-weight:var(--font-weight-regular)}

    /* Preview */
    .builder-preview{background:var(--bg-primary);overflow:auto;display:flex;flex-direction:column}
    .builder-page-preview{width:100%}
    .builder-page-preview .navbar{position:relative;top:auto;left:auto;transform:none;width:calc(100% - var(--space-6));max-width:var(--container-max-width);margin:var(--space-3) auto}
    .builder-sections-zone{flex:1;padding:var(--space-4) var(--space-6)}
    .builder-section-wrapper{position:relative;border:2px solid transparent;border-radius:var(--radius-1);transition:border-color var(--duration-2) var(--easing-out);cursor:pointer}
    .builder-section-wrapper:hover{border-color:rgba(148,122,252,0.3)}
    .builder-section-wrapper.is-selected{border-color:var(--color-purple-400)}
    .builder-section-wrapper .builder-section-label{position:absolute;top:-10px;left:16px;font-size:10px;font-family:var(--font-mono);font-weight:var(--font-weight-medium);text-transform:uppercase;letter-spacing:0.06em;color:var(--color-purple-400);background:var(--bg-primary);padding:0 6px;opacity:0;transition:opacity var(--duration-2) var(--easing-out)}
    .builder-section-wrapper:hover .builder-section-label,.builder-section-wrapper.is-selected .builder-section-label{opacity:1}
    .builder-add-zone{display:flex;align-items:center;justify-content:center;height:4px;margin:4px 0;position:relative;transition:height var(--duration-2) var(--easing-out)}
    .builder-add-zone:hover{height:32px}
    .builder-add-zone-btn{display:none;align-items:center;justify-content:center;width:28px;height:28px;background:var(--color-purple-400);border:none;border-radius:var(--radius-full);color:white;font-size:16px;cursor:pointer;line-height:1;transition:transform var(--duration-2) var(--easing-out)}
    .builder-add-zone:hover .builder-add-zone-btn{display:flex}
    .builder-add-zone-btn:hover{transform:scale(1.15)}
    .builder-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:300px;color:var(--text-tertiary);gap:var(--space-2)}
    .builder-empty-icon{width:48px;height:48px;border-radius:var(--radius-full);background:var(--bg-tertiary);display:flex;align-items:center;justify-content:center}
    .builder-empty-icon svg{width:24px;height:24px;stroke:var(--text-tertiary);fill:none}
    .builder-empty-text{font-size:var(--font-size-14);color:var(--text-tertiary)}

    /* Prototypes Drawer */
    .proto-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:300;opacity:0;visibility:hidden;transition:opacity var(--duration-3) var(--easing-out),visibility var(--duration-3)}
    .proto-backdrop.is-open{opacity:1;visibility:visible}
    .proto-drawer{position:fixed;top:0;left:0;width:360px;height:100vh;background:var(--bg-secondary);border-right:1px solid var(--border-primary);z-index:301;transform:translateX(-100%);transition:transform var(--duration-3) var(--easing-out);display:flex;flex-direction:column;overflow:hidden}
    .proto-drawer.is-open{transform:translateX(0)}
    .proto-drawer-header{display:flex;align-items:center;justify-content:space-between;padding:var(--space-3);border-bottom:1px solid var(--border-primary);flex-shrink:0}
    .proto-drawer-title{font-size:var(--font-size-16);font-weight:var(--font-weight-medium);color:var(--text-primary)}
    .proto-drawer-close{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:transparent;border:none;border-radius:var(--radius-1);color:var(--text-tertiary);cursor:pointer;font-size:18px;transition:all var(--duration-2) var(--easing-out)}
    .proto-drawer-close:hover{background:var(--bg-tertiary);color:var(--text-primary)}
    .proto-drawer-body{flex:1;overflow-y:auto;padding:var(--space-3);display:flex;flex-direction:column;gap:var(--space-2)}
    .proto-drawer-body::-webkit-scrollbar{width:6px}
    .proto-drawer-body::-webkit-scrollbar-track{background:transparent}
    .proto-drawer-body::-webkit-scrollbar-thumb{background:var(--color-neutral-700);border-radius:3px}
    .proto-new-btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:10px;background:transparent;border:1px dashed var(--border-primary);border-radius:var(--radius-1);color:var(--text-tertiary);font-size:var(--font-size-14);font-weight:var(--font-weight-medium);font-family:var(--font-sans);cursor:pointer;transition:all var(--duration-2) var(--easing-out);flex-shrink:0}
    .proto-new-btn:hover{border-color:var(--color-purple-400);color:var(--color-purple-400);background:rgba(148,122,252,0.04)}
    .proto-item{display:flex;flex-direction:column;gap:6px;padding:var(--space-2);background:var(--bg-tertiary);border:2px solid transparent;border-radius:var(--radius-1);transition:all var(--duration-2) var(--easing-out)}
    .proto-item:hover{background:var(--bg-elevated)}
    .proto-item.is-active{border-color:var(--color-purple-400);background:rgba(148,122,252,0.08)}
    .proto-item-top{display:flex;align-items:center;gap:8px}
    .proto-item-dot{width:8px;height:8px;border-radius:50%;background:var(--color-purple-400);flex-shrink:0;opacity:0}
    .proto-item.is-active .proto-item-dot{opacity:1}
    .proto-item-name{flex:1;font-size:var(--font-size-14);font-weight:var(--font-weight-medium);color:var(--text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .proto-item-name-input{flex:1;font-size:var(--font-size-14);font-weight:var(--font-weight-medium);color:var(--text-primary);background:var(--bg-secondary);border:1px solid var(--color-purple-400);border-radius:4px;padding:2px 6px;font-family:var(--font-sans);outline:none}
    .proto-item-meta{font-size:var(--font-size-12);color:var(--text-tertiary);padding-left:16px}
    .proto-item-actions{display:flex;gap:4px;padding-left:16px}
    .proto-item-btn{height:28px;padding:0 10px;background:var(--bg-secondary);border:1px solid var(--border-primary);border-radius:6px;color:var(--text-secondary);font-size:var(--font-size-12);font-family:var(--font-sans);cursor:pointer;transition:all var(--duration-2) var(--easing-out)}
    .proto-item-btn:hover{background:var(--bg-elevated);color:var(--text-primary);border-color:var(--border-secondary)}
    .proto-item-btn.is-danger:hover{color:var(--color-red-500);border-color:var(--color-red-500)}
    .proto-empty{text-align:center;padding:var(--space-6) var(--space-3);color:var(--text-tertiary)}
    .proto-empty-icon{font-size:32px;margin-bottom:var(--space-2);opacity:0.4}
    .proto-empty-text{font-size:var(--font-size-14)}
    .proto-save-btn{position:relative;display:inline-flex;align-items:center;gap:6px;height:32px;padding:0 12px;background:var(--bg-tertiary);color:var(--text-secondary);border:1px solid var(--border-primary);border-radius:var(--radius-full);font-size:var(--font-size-12);font-weight:var(--font-weight-medium);font-family:var(--font-sans);cursor:pointer;transition:all var(--duration-2) var(--easing-out)}
    .proto-save-btn:hover{background:var(--bg-elevated);color:var(--text-primary);border-color:var(--border-secondary)}
    .proto-save-btn.is-saved{background:var(--color-green-500);color:white;border-color:var(--color-green-500)}
    .proto-unsaved-dot{position:absolute;top:-2px;right:-2px;width:8px;height:8px;border-radius:50%;background:var(--color-purple-400);display:none}
    .proto-unsaved-dot.is-visible{display:block}
    .proto-toggle-btn{display:inline-flex;align-items:center;gap:6px;height:32px;padding:0 12px;background:var(--bg-tertiary);color:var(--text-secondary);border:1px solid var(--border-primary);border-radius:var(--radius-full);font-size:var(--font-size-12);font-weight:var(--font-weight-medium);font-family:var(--font-sans);cursor:pointer;transition:all var(--duration-2) var(--easing-out)}
    .proto-toggle-btn:hover{background:var(--bg-elevated);color:var(--text-primary);border-color:var(--border-secondary)}
  </style>
</head>
<body>
<div class="builder-app">

  <!-- ==================== TOP BAR ==================== -->
  <div class="builder-topbar">
    <div class="builder-topbar-left">
      <span class="builder-topbar-title">Page Builder</span>
      <span class="builder-topbar-badge">v2</span>
    </div>
    <div class="builder-topbar-right">
      <button class="proto-save-btn" id="protoSaveBtn" onclick="saveCurrentProto()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        <span id="protoSaveBtnText">Save</span>
        <span class="proto-unsaved-dot" id="protoUnsavedDot"></span>
      </button>
      <button class="proto-toggle-btn" onclick="toggleProtoDrawer()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
        My Prototypes
      </button>
      <div class="builder-scope-toggle" id="scopeToggle">
        <button class="builder-scope-btn is-active" data-scope="sections">Sections</button>
        <button class="builder-scope-btn" data-scope="full">Full Page</button>
      </div>
      <button class="builder-export-btn" id="exportBtn" onclick="exportHTML()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        <span id="exportBtnText">Copy HTML</span>
      </button>
    </div>
  </div>

  <!-- ==================== SIDEBAR ==================== -->
  <div class="builder-sidebar">
    <!-- Section list -->
    <div class="builder-group">
      <div class="builder-group-title">Page Sections</div>
      <div class="builder-section-list" id="sectionList"></div>
      <button class="builder-add-section-btn" id="addSectionBtn" onclick="toggleTypePicker()">+ Add Section</button>
      <div class="builder-type-picker" id="typePicker">
        <button class="builder-type-btn" onclick="addSection('bento-a')">
          <div class="builder-type-btn-icon">&#9641;</div>
          <div class="builder-type-btn-text"><span class="builder-type-btn-name">Bento A</span><span class="builder-type-btn-desc">50/50 split — hero + 4 cells</span></div>
        </button>
        <button class="builder-type-btn" onclick="addSection('bento-b')">
          <div class="builder-type-btn-icon">&#9644;</div>
          <div class="builder-type-btn-text"><span class="builder-type-btn-name">Bento B</span><span class="builder-type-btn-desc">Stacked hero + 3 cells</span></div>
        </button>
        <button class="builder-type-btn" onclick="addSection('bento-1x1')">
          <div class="builder-type-btn-icon">&#9632;</div>
          <div class="builder-type-btn-text"><span class="builder-type-btn-name">Bento 1x1</span><span class="builder-type-btn-desc">Hero only, centered</span></div>
        </button>
        <button class="builder-type-btn" onclick="addSection('statement')">
          <div class="builder-type-btn-icon">&#8220;</div>
          <div class="builder-type-btn-text"><span class="builder-type-btn-name">Statement</span><span class="builder-type-btn-desc">Large centered text block</span></div>
        </button>
        <button class="builder-type-btn" onclick="addSection('cta')">
          <div class="builder-type-btn-icon">&#10148;</div>
          <div class="builder-type-btn-text"><span class="builder-type-btn-name">CTA</span><span class="builder-type-btn-desc">Call to action with buttons</span></div>
        </button>
        <button class="builder-type-btn" onclick="addSection('hero')">
          <div class="builder-type-btn-icon">&#9733;</div>
          <div class="builder-type-btn-text"><span class="builder-type-btn-name">Hero</span><span class="builder-type-btn-desc">Full-height hero with glow</span></div>
        </button>
        <button class="builder-type-btn" onclick="addSection('text-media')">
          <div class="builder-type-btn-icon">&#9776;</div>
          <div class="builder-type-btn-text"><span class="builder-type-btn-name">Text + Media</span><span class="builder-type-btn-desc">Split layout with text &amp; media</span></div>
        </button>
        <button class="builder-type-btn" onclick="addSection('list-media')">
          <div class="builder-type-btn-icon">&#9776;</div>
          <div class="builder-type-btn-text"><span class="builder-type-btn-name">List + Media</span><span class="builder-type-btn-desc">Bullet list with media</span></div>
        </button>
        <button class="builder-type-btn" onclick="addSection('related')">
          <div class="builder-type-btn-icon">&#9881;</div>
          <div class="builder-type-btn-text"><span class="builder-type-btn-name">Related</span><span class="builder-type-btn-desc">3-column cards with images</span></div>
        </button>
      </div>
    </div>

    <div class="builder-divider"></div>

    <!-- Contextual controls -->
    <div id="sectionControls"></div>
  </div>

  <!-- ==================== PREVIEW ==================== -->
  <div class="builder-preview">
    <div class="builder-page-preview" id="pagePreview"></div>
  </div>

</div>

<!-- Prototypes Drawer -->
<div class="proto-backdrop" id="protoBackdrop" onclick="toggleProtoDrawer()"></div>
<div class="proto-drawer" id="protoDrawer">
  <div class="proto-drawer-header">
    <span class="proto-drawer-title">My Prototypes</span>
    <button class="proto-drawer-close" onclick="toggleProtoDrawer()">&times;</button>
  </div>
  <div class="proto-drawer-body" id="protoDrawerBody"></div>
</div>

<script>
// ==========================================================
//  ICONS
// ==========================================================

const ICONS = {
  sparkle: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3l1.5 3.5L17 8l-3.5 1.5L12 13l-1.5-3.5L7 8l3.5-1.5L12 3z"/><path d="M18 13l1 2.5L21.5 17l-2.5 1L18 20.5 17 18l-2.5-1L17 16l1-3z"/></svg>',
  headphones: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3z"/><path d="M3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></svg>',
  droplet: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>',
  pulse: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>',
  code: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>',
  link: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>',
  grid: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="12" y1="3" x2="12" y2="21"/></svg>',
  dollar: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>',
  lock: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>',
  globe: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>',
  refresh: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>',
  translate: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 8l6 6"/><path d="M4 14l6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="M22 22l-5-10-5 10"/><path d="M14 18h6"/></svg>',
  briefcase: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>',
  shield: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',
  zap: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>',
  layers: '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>',
};
const ICON_KEYS = Object.keys(ICONS);
const COMP_CELLS = { 'bento-a': 4, 'bento-b': 3, 'bento-1x1': 0 };

const SECTION_LABELS = {
  'bento-a': 'Bento A',
  'bento-b': 'Bento B',
  'bento-1x1': 'Bento 1x1',
  'statement': 'Statement',
  'cta': 'CTA',
  'hero': 'Hero',
  'text-media': 'Text + Media',
  'list-media': 'List + Media',
  'related': 'Related',
};

// ==========================================================
//  NAVBAR / FOOTER CHROME (template strings)
// ==========================================================

const GLADIA_LOGO = `<svg viewBox="0 0 322 82" fill="none" xmlns="http://www.w3.org/2000/svg" style="height:24px;width:auto;"><path d="M125.497 14.5989C128.431 14.5989 131.174 15.0301 133.728 15.8928C136.299 16.7383 138.594 17.9461 140.613 19.5168C142.632 21.0867 144.289 22.9511 145.583 25.1077C146.894 27.2642 147.748 29.6455 148.146 32.2512H138.362C137.965 30.8536 137.378 29.5935 136.602 28.4719C135.825 27.3506 134.884 26.4014 133.78 25.6252C132.676 24.8317 131.433 24.2364 130.053 23.8391C128.69 23.4246 127.214 23.218 125.626 23.218C122.762 23.2181 120.2 23.9343 117.94 25.3665C115.679 26.7987 113.892 28.904 112.581 31.6819C111.287 34.4426 110.64 37.8078 110.64 41.7766C110.64 45.7798 111.27 49.1706 112.529 51.9485C113.807 54.7264 115.567 56.8416 117.81 58.2903C120.053 59.7225 122.65 60.4387 125.601 60.4387C128.361 60.4387 130.752 59.8958 132.771 58.8088C134.79 57.721 136.343 56.211 137.43 54.2786C138.462 52.4728 139.012 50.4109 139.079 48.092H126.559V40.5862H148.533V68.3333H141.649L140.949 62.1213H140.665C138.801 64.3472 136.653 66.0645 134.22 67.2717C131.787 68.4625 128.896 69.0588 125.549 69.0588C120.683 69.0588 116.403 67.9629 112.71 65.7717C109.035 63.5624 106.163 60.4304 104.092 56.3752C102.021 52.3026 100.986 47.4707 100.986 41.8801C100.986 37.6006 101.607 33.7781 102.849 30.4133C104.092 27.0489 105.825 24.1928 108.051 21.8459C110.278 19.4826 112.875 17.6876 115.843 16.4622C118.81 15.2203 122.029 14.5989 125.497 14.5989ZM191.687 28.0588C194.016 28.0588 195.931 28.4548 197.433 29.2483C198.934 30.0255 200.126 30.9663 201.006 32.0706C201.885 33.1573 202.567 34.1841 203.05 35.1506H203.439V28.5764H212.834V68.3333H203.619V62.0696H203.05C202.567 63.0362 201.868 64.0628 200.953 65.1497C200.039 66.2192 198.831 67.1339 197.329 67.8928C195.829 68.6527 193.939 69.0325 191.661 69.0325C188.538 69.0325 185.743 68.2305 183.275 66.6252C180.807 65.0208 178.857 62.691 177.425 59.637C175.993 56.5821 175.277 52.872 175.277 48.5071C175.277 44.0891 176.001 40.3612 177.45 37.3245C178.917 34.2704 180.894 31.9659 183.378 30.4133C185.863 28.8426 188.633 28.0588 191.687 28.0588ZM258.017 68.3333H248.802V62.0696H248.233C247.749 63.0361 247.05 64.0629 246.136 65.1497C245.222 66.2193 244.013 67.1339 242.512 67.8928C241.01 68.6527 239.122 69.0325 236.844 69.0325C233.72 69.0324 230.924 68.2306 228.457 66.6252C225.99 65.0208 224.039 62.691 222.608 59.637C221.175 56.5821 220.459 52.872 220.459 48.5071C220.459 44.0892 221.183 40.3612 222.633 37.3245C224.1 34.2705 226.075 31.9659 228.561 30.4133C231.045 28.8426 233.815 28.0589 236.869 28.0588C239.199 28.0588 241.115 28.4547 242.616 29.2483C244.117 30.0254 245.308 30.9664 246.188 32.0706C247.068 33.1573 247.749 34.1841 248.233 35.1506H248.621V15.3235H258.017V68.3333ZM300.328 28.0588C302.658 28.0588 304.573 28.4549 306.074 29.2483C307.575 30.0255 308.767 30.9663 309.647 32.0706C310.527 33.1573 311.208 34.1841 311.692 35.1506H312.08V28.5764H321.476V68.3333H312.261V62.0696H311.692C311.208 63.0361 310.509 64.0629 309.595 65.1497C308.681 66.2193 307.472 67.1339 305.971 67.8928C304.469 68.6527 302.581 69.0325 300.303 69.0325C297.179 69.0325 294.383 68.2306 291.916 66.6252C289.449 65.0208 287.498 62.691 286.067 59.637C284.634 56.5821 283.918 52.872 283.918 48.5071C283.918 44.0891 284.642 40.3612 286.092 37.3245C287.559 34.2704 289.534 31.9659 292.02 30.4133C294.504 28.8426 297.274 28.0589 300.328 28.0588ZM166.079 56.9446C166.079 58.4287 166.303 59.4904 166.752 60.1282C167.2 60.7668 167.994 61.069 169.133 61.0344C169.754 61.0171 170.22 60.9828 170.53 60.9309C170.858 60.8617 171.153 60.7931 171.411 60.7239L172.964 67.8157C172.412 67.9878 171.722 68.1521 170.894 68.3079C170.083 68.4628 169.081 68.5574 167.891 68.592C164.094 68.6958 161.282 67.9021 159.452 66.2112C157.624 64.5202 156.709 61.9402 156.709 58.4719V15.3235H166.079V56.9446ZM276.643 68.3333H267.273V28.5764H276.643V68.3333ZM194.276 35.7454C192.188 35.7454 190.445 36.2893 189.047 37.3762C187.649 38.4632 186.596 39.965 185.889 41.8801C185.181 43.7952 184.828 45.9873 184.828 48.4543C184.828 50.9389 185.181 53.157 185.889 55.1067C186.613 57.0391 187.675 58.5662 189.072 59.6887C190.487 60.793 192.222 61.345 194.276 61.345C196.26 61.3449 197.95 60.8099 199.348 59.7395C200.745 58.6525 201.807 57.1427 202.532 55.2102C203.257 53.2778 203.619 51.0254 203.619 48.4543C203.619 45.8835 203.257 43.6489 202.532 41.7512C201.824 39.8534 200.772 38.3768 199.374 37.3245C197.994 36.2724 196.294 35.7454 194.276 35.7454ZM239.458 35.7454C237.37 35.7454 235.626 36.2893 234.229 37.3762C232.831 38.4632 231.779 39.9651 231.071 41.8801C230.364 43.7952 230.011 45.9872 230.011 48.4543C230.011 50.9389 230.364 53.1569 231.071 55.1067C231.797 57.0391 232.858 58.5662 234.256 59.6887C235.671 60.7928 237.405 61.345 239.458 61.345C241.443 61.3449 243.134 60.81 244.531 59.7395C245.929 58.6526 246.99 57.1425 247.714 55.2102C248.439 53.2778 248.802 51.0254 248.802 48.4543C248.802 45.8835 248.439 43.6489 247.714 41.7512C247.007 39.8534 245.955 38.3768 244.557 37.3245C243.177 36.2722 241.477 35.7454 239.458 35.7454ZM302.917 35.7454C300.829 35.7454 299.085 36.2893 297.688 37.3762C296.29 38.4632 295.238 39.9651 294.53 41.8801C293.823 43.7952 293.47 45.9872 293.47 48.4543C293.47 50.9389 293.823 53.1569 294.53 55.1067C295.256 57.039 296.317 58.5663 297.714 59.6887C299.129 60.793 300.864 61.345 302.917 61.345C304.901 61.3449 306.593 60.81 307.99 59.7395C309.388 58.6526 310.449 57.1425 311.173 55.2102C311.898 53.2778 312.261 51.0254 312.261 48.4543C312.261 45.8835 311.898 43.6489 311.173 41.7512C310.466 39.8534 309.414 38.3768 308.016 37.3245C306.636 36.2722 304.936 35.7454 302.917 35.7454ZM271.983 12.761C273.484 12.761 274.762 13.2616 275.815 14.2629C276.884 15.2459 277.418 16.4449 277.418 17.8596C277.418 19.258 276.884 20.457 275.815 21.4573C274.762 22.4413 273.484 22.9338 271.983 22.9338C270.499 22.9338 269.222 22.4412 268.153 21.4573C267.083 20.4569 266.548 19.2581 266.548 17.8596C266.548 16.4448 267.083 15.246 268.153 14.2629C269.222 13.2617 270.499 12.7611 271.983 12.761Z" fill="white"/><path d="M42.8783 53.1389C48.1056 53.139 53.1197 55.2166 56.8177 58.9143L71.1429 75.5637H62.7972C60.6349 75.5636 58.5758 74.6324 57.1468 73.0061L45.2816 59.4934V82.0002H37.3314V59.9797L25.8949 73.0032C24.4689 74.6263 22.41 75.5598 20.2445 75.5598H11.8929L26.2279 58.9104C29.9259 55.2129 34.9401 53.135 40.1673 53.135H42.8783V53.1389ZM23.6126 25.7092C27.3105 29.407 29.388 34.4208 29.388 39.6477V42.3586C29.388 47.5855 27.3105 52.5994 23.6126 56.2971L6.96127 70.6213V62.2766L6.95834 62.2737C6.95834 60.1115 7.89247 58.0523 9.51889 56.6233L23.0326 44.759H0.52475V36.8088H22.5472L9.52182 25.3733C7.89561 23.9475 6.96136 21.889 6.96127 19.7239V11.3723L23.6126 25.7092ZM76.0843 19.717C76.0843 21.8793 75.1532 23.9385 73.5267 25.3674L60.013 37.2317H82.5247V45.1819H60.5023L73.5267 56.6165C75.1501 58.0423 76.0843 60.1015 76.0843 62.2668V70.6184L59.4339 56.2844C55.7359 52.5866 53.6576 47.573 53.6576 42.3459V39.635C53.6576 34.408 55.7359 29.3943 59.4339 25.6965L76.0843 11.3723V19.717ZM45.7083 22.0139L57.1439 8.99048C58.5698 7.36731 60.6288 6.43385 62.7943 6.43384H71.1458L56.8119 23.0833C53.1138 26.781 48.0989 28.8586 42.8714 28.8586H40.1605L40.1576 28.8616C34.9303 28.8615 29.9161 26.7839 26.2181 23.0862L11.8929 6.43677H20.2386C22.401 6.43682 24.46 7.37096 25.889 8.99731L37.7572 22.5061V0.000244141H45.7083V22.0139Z" fill="white"/></svg>`;

const NAVBAR_HTML = `<nav class="navbar">
  <div class="navbar-inner">
    <a href="/" class="navbar-logo">${GLADIA_LOGO}</a>
    <div class="navbar-links">
      <button data-menu="product">Product</button>
      <button data-menu="solutions">Solutions</button>
      <a href="#">Pricing</a>
      <button data-menu="developers">Developers</button>
      <button data-menu="company">Company</button>
    </div>
    <div class="navbar-actions">
      <a href="#" class="btn btn-ghost btn-sm"><span class="btn-text-wrapper"><span class="btn-text">Request a demo</span><span class="btn-text-clone">Request a demo</span></span></a>
      <a href="#" class="btn btn-primary btn-sm"><span class="btn-text-wrapper"><span class="btn-text">Sign up</span><span class="btn-text-clone">Sign up</span></span></a>
    </div>
  </div>
  <div class="mega-menu" id="megaMenu">
    <div class="mega-menu-panel" data-panel="product"><div class="mega-menu-bridge"></div>
      <div class="mega-menu-col"><span class="mega-menu-col-title">Platform</span><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#9889;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">Real-time STT</span><span class="mega-menu-item-desc">Sub-300ms streaming transcription</span></div></a><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#128193;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">Batch STT</span><span class="mega-menu-item-desc">Process audio files at scale</span></div></a><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#127758;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">Translation</span><span class="mega-menu-item-desc">Any-to-any language translation</span></div></a></div>
      <div class="mega-menu-col"><span class="mega-menu-col-title">Models</span><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#10024;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">Solaria</span><span class="mega-menu-item-desc">Our latest, most accurate model</span></div></a></div>
      <div class="mega-menu-col"><span class="mega-menu-col-title">Features</span><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#128100;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">Speaker diarization</span><span class="mega-menu-item-desc">Identify who said what</span></div></a></div>
      <div class="mega-menu-featured"><span class="mega-menu-featured-title">Featured</span><a href="#" class="mega-menu-featured-card"><span class="mega-menu-featured-card-title">What's new in Solaria</span><span class="mega-menu-featured-card-desc">Our latest model delivers 39% better accuracy on European languages.</span></a></div>
    </div>
    <div class="mega-menu-panel" data-panel="solutions"><div class="mega-menu-bridge"></div>
      <div class="mega-menu-col"><span class="mega-menu-col-title">Use cases</span><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#129302;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">Voice agents</span><span class="mega-menu-item-desc">Power conversational AI</span></div></a><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#127911;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">Customer experience</span><span class="mega-menu-item-desc">Analyze support interactions</span></div></a></div>
      <div class="mega-menu-col"></div><div class="mega-menu-col"></div>
      <div class="mega-menu-featured"><span class="mega-menu-featured-title">Featured</span><a href="#" class="mega-menu-featured-card"><span class="mega-menu-featured-card-title">Voice agents guide</span><span class="mega-menu-featured-card-desc">Learn how to build production-ready voice agents with Gladia.</span></a></div>
    </div>
    <div class="mega-menu-panel" data-panel="developers"><div class="mega-menu-bridge"></div>
      <div class="mega-menu-col"><span class="mega-menu-col-title">Resources</span><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#128214;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">Documentation</span><span class="mega-menu-item-desc">API references and guides</span></div></a><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#128230;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">SDKs</span><span class="mega-menu-item-desc">Python, Node, and more</span></div></a></div>
      <div class="mega-menu-col"></div><div class="mega-menu-col"></div>
      <div class="mega-menu-featured"><span class="mega-menu-featured-title">Featured</span><a href="#" class="mega-menu-featured-card"><span class="mega-menu-featured-card-title">Quick start guide</span><span class="mega-menu-featured-card-desc">Go from zero to transcription in under 5 minutes.</span></a></div>
    </div>
    <div class="mega-menu-panel" data-panel="company"><div class="mega-menu-bridge"></div>
      <div class="mega-menu-col"><span class="mega-menu-col-title">Company</span><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#127970;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">About us</span><span class="mega-menu-item-desc">Our mission and team</span></div></a><a href="#" class="mega-menu-item"><div class="mega-menu-item-icon">&#128188;</div><div class="mega-menu-item-text"><span class="mega-menu-item-title">Careers</span><span class="mega-menu-item-desc">Join the team</span></div></a></div>
      <div class="mega-menu-col"></div><div class="mega-menu-col"></div>
      <div class="mega-menu-featured"><span class="mega-menu-featured-title">Featured</span><a href="#" class="mega-menu-featured-card"><span class="mega-menu-featured-card-title">We're hiring!</span><span class="mega-menu-featured-card-desc">Join us in building the future of speech AI.</span></a></div>
    </div>
  </div>
</nav>`;

const FOOTER_HTML = `<footer class="footer">
  <div class="container">
    <div class="footer-top">
      <div class="footer-brand">
        ${GLADIA_LOGO}
        <p class="footer-brand-desc">The most reliable state-of-the-art Speech-To-Text API provider. Powering 300,000+ developers worldwide.</p>
      </div>
      <div class="footer-columns">
        <div class="footer-column"><span class="footer-column-title">Product</span><a href="#">Real-time STT</a><a href="#">Batch STT</a><a href="#">Solaria Model</a><a href="#">Pricing</a></div>
        <div class="footer-column"><span class="footer-column-title">Solutions</span><a href="#">Voice Agents</a><a href="#">Customer Experience</a><a href="#">Sales Enablement</a><a href="#">Meeting Assistants</a></div>
        <div class="footer-column"><span class="footer-column-title">Developers</span><a href="#">Documentation</a><a href="#">Playground</a><a href="#">Status</a><a href="#">Discord</a></div>
        <div class="footer-column"><span class="footer-column-title">Company</span><a href="#">About us</a><a href="#">Blog</a><a href="#">Careers</a><a href="#">Press</a></div>
      </div>
    </div>
    <div class="footer-bottom">
      <span class="footer-bottom-text">&copy; 2025 Gladia. All rights reserved.</span>
      <div class="footer-bottom-links"><a href="#">Privacy Policy</a><a href="#">Terms of Service</a><a href="#">Cookie Policy</a></div>
    </div>
  </div>
</footer>`;

// ==========================================================
//  PAGE STATE
// ==========================================================

let secCounter = 0;

const pageState = {
  sections: [],
  selectedId: null,
  exportScope: 'sections',
  activeProtoId: null,
  dirty: false,
};

// ==========================================================
//  FACTORY FUNCTIONS
// ==========================================================

function createBentoData(comp) {
  const cellCount = COMP_CELLS[comp] || 0;
  const defaultCells = [
    { title: 'Sub-300ms latency', desc: 'To keep conversations seamless and ensure smooth, uninterrupted dialogue every time.', icon: 'sparkle' },
    { title: 'Leading STT accuracy', desc: 'Capturing numerical, jargon, and key entities such as names and emails.', icon: 'headphones' },
    { title: 'Predictable performance', desc: 'Forget variance spikes to deliver a consistent user experience.', icon: 'droplet' },
    { title: 'Optimized for SIP', desc: 'As well as telephony protocols (8 kHz), fitting natively into your existing workflows.', icon: 'pulse' },
  ];
  return {
    composition: comp.replace('bento-', ''),
    heroVariant: 'stacked',
    inverted: false,
    animated: true,
    tagLabel: 'SECTION',
    sectionTitle: '',
    sectionSubtitle: '',
    heroTitle: "Performance that\nwon't disappoint",
    heroSubtitle: 'Async and real-time STT models with top precision on key entities.',
    ctaEnabled: true,
    ctaText: 'Learn more',
    cells: defaultCells.slice(0, cellCount),
  };
}

function createSection(type) {
  secCounter++;
  const id = 'sec_' + secCounter;
  if (type === 'statement') {
    return { id, type, data: { title: 'Most voice platform failures start with faulty STT.', body: 'From missed key information to misattributed speakers, bad transcripts break trust in your product.' } };
  }
  if (type === 'cta') {
    return { id, type, data: { title: 'Ready to get started?', subtitle: 'Start building with the most accurate speech-to-text API.', primaryText: 'Sign up free', secondaryText: 'Request a demo' } };
  }
  if (type === 'hero') {
    return { id, type, data: { badgeEnabled: true, badgeTag: 'NEW', badgeText: 'Benchmarks live now', headline: 'The speech-to-text\nbackbone for\nvoice agents', subtitle: 'From async to live streaming, our API empowers your platform with accurate, fully multilingual speech-to-text and actionable speaker insights.', primaryText: 'Sign up free', secondaryText: 'Request a demo', bgGlow: true } };
  }
  if (type === 'text-media') {
    return { id, type, data: { tagLabel: 'LOREM IPSUM', title: 'Suscipit semper placerat orci faucibus ut ornare felis', subtitle: 'Nisl dolor ipsum egestas a sollicitudin nisl sagittis. Auctor tristique platea vitae aliquet auctor urna vulputate nibh. Ornare convallis.', ctaEnabled: false, ctaText: 'CTA Button', inverted: false } };
  }
  if (type === 'list-media') {
    return { id, type, data: { heading: 'Suscipit semper placerat orci faucibus placerat orci faucibus', inverted: false, items: [{ title: 'Lorem Ipsum', desc: 'ornare sem cursus in non. Tellus lacus augue vulputate dui. Porta.' }, { title: 'Lorem Ipsum', desc: 'ornare sem cursus in non. Tellus lacus augue vulputate dui. Porta.' }] } };
  }
  if (type === 'related') {
    return { id, type, data: { heading: 'Viverra convallis etiam dol tincidunt', cards: [{ title: 'Diam', desc: 'Elit urna dolor sit a. Fermentum quis tortor in eros id iaculis lacus tincidunt faucibus.', ctaText: 'CTA Button' }, { title: 'Pellentesque', desc: 'Sem volutpat fermentum duis nullam est amet. Mauris quis malesuada enim velit euismod.', ctaText: 'CTA Button' }, { title: 'Auctor', desc: 'Sollicitudin netus pulvinar enim in. Arcu volutpat et urna faucibus lorem purus odio eu.', ctaText: 'CTA Button' }] } };
  }
  return { id, type, data: createBentoData(type) };
}

// ==========================================================
//  HELPERS
// ==========================================================

function escAttr(s) { return s.replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }
function escHTML(s) { return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;'); }

function getSelected() {
  return pageState.sections.find(s => s.id === pageState.selectedId) || null;
}

// ==========================================================
//  SECTION HTML BUILDERS
// ==========================================================

function buildBentoCTA(text, indent) {
  return `${indent}<a href="#" class="b__cta">\n${indent}  <span class="btn-text-wrapper">\n${indent}    <span class="btn-text">${escHTML(text)}</span>\n${indent}    <span class="btn-text-clone">${escHTML(text)}</span>\n${indent}  </span>\n${indent}</a>\n`;
}

function buildBentoHTML(data) {
  const { composition, heroVariant, inverted, animated, tagLabel, sectionTitle, sectionSubtitle, heroTitle, heroSubtitle, ctaEnabled, ctaText, cells } = data;
  let html = '';
  html += `<section class="section" style="padding: var(--space-8) 0;">\n  <div class="container">\n`;
  if (tagLabel) html += `    <div class="tag-label" style="margin-bottom: var(--space-4);"><span class="tag-indicator"></span><span class="tag-text">${escHTML(tagLabel)}</span></div>\n`;
  if (sectionTitle) html += `    <h2 class="section-title">${escHTML(sectionTitle)}</h2>\n`;
  if (sectionSubtitle) html += `    <p class="section-subtitle">${escHTML(sectionSubtitle)}</p>\n`;
  const compClass = composition === '1x1' ? 'bento-1x1' : `bento-${composition}`;
  const invClass = (composition === 'a' && inverted) ? ' bento-a--inv' : '';
  const animClass = animated ? ' b--animated' : '';
  html += `    <div class="${compClass}${invClass}${animClass}">\n`;
  const heroClass = heroVariant === 'overlay' ? 'b__hero-overlay' : 'b__hero-stacked';
  html += `      <div class="b__card ${heroClass}">\n        <div class="b__hero-content">\n`;
  html += `          <h2 class="b__hero-title">${escHTML(heroTitle).replace(/\n/g, '<br>')}</h2>\n`;
  html += `          <p class="b__hero-subtitle">${escHTML(heroSubtitle)}</p>\n`;
  if (composition === '1x1' && ctaEnabled && ctaText) html += buildBentoCTA(ctaText, '          ');
  html += `        </div>\n        <div class="b__hero-visual"></div>\n`;
  if (composition !== '1x1' && ctaEnabled && ctaText) html += buildBentoCTA(ctaText, '        ');
  html += `      </div>\n`;
  const cellCount = COMP_CELLS['bento-' + composition] || 0;
  if (cellCount > 0) {
    html += `      <div class="b__card b__features">\n`;
    for (let i = 0; i < cellCount && i < cells.length; i++) {
      const c = cells[i];
      html += `        <div class="b__cell"><div class="b__cell-icon">${ICONS[c.icon]}</div><h3 class="b__cell-title">${escHTML(c.title)}</h3><p class="b__cell-desc">${escHTML(c.desc)}</p></div>\n`;
    }
    html += `      </div>\n`;
  }
  html += `    </div>\n  </div>\n</section>`;
  return html;
}

function buildStatementHTML(data) {
  return `<div class="statement-section">\n  <div class="container">\n    <div class="statement-text">\n      <p class="statement-title">${escHTML(data.title)}</p>\n      <p class="statement-body">${escHTML(data.body)}</p>\n    </div>\n  </div>\n</div>`;
}

function buildCtaHTML(data) {
  let html = `<div class="cta-section">\n  <div class="container">\n    <div class="cta-content">\n`;
  html += `      <h2 class="cta-title">${escHTML(data.title)}</h2>\n`;
  html += `      <p class="cta-subtitle">${escHTML(data.subtitle)}</p>\n`;
  html += `      <div class="cta-actions">\n`;
  if (data.primaryText) html += `        <a href="#" class="btn btn-primary btn-md"><span class="btn-text-wrapper"><span class="btn-text">${escHTML(data.primaryText)}</span><span class="btn-text-clone">${escHTML(data.primaryText)}</span></span></a>\n`;
  if (data.secondaryText) html += `        <a href="#" class="btn btn-secondary btn-md"><span class="btn-text-wrapper"><span class="btn-text">${escHTML(data.secondaryText)}</span><span class="btn-text-clone">${escHTML(data.secondaryText)}</span></span></a>\n`;
  html += `      </div>\n    </div>\n  </div>\n</div>`;
  return html;
}



function buildTextMediaHTML(data) {
  const invClass = data.inverted ? ' text-media-grid--inv' : '';
  let html = '<section class="text-media">\n  <div class="container">\n';
  html += '    <div class="text-media-grid' + invClass + '">\n';
  html += '      <div class="text-media-content">\n';
  if (data.tagLabel) html += '        <div class="tag-label"><span class="tag-indicator"></span><span class="tag-text">' + escHTML(data.tagLabel) + '</span></div>\n';
  html += '        <h2 class="text-media-title">' + escHTML(data.title) + '</h2>\n';
  html += '        <p class="text-media-subtitle">' + escHTML(data.subtitle) + '</p>\n';
  if (data.ctaEnabled && data.ctaText) {
    html += '        <div><a href="#" class="btn btn-primary btn-md"><span class="btn-text-wrapper"><span class="btn-text">' + escHTML(data.ctaText) + '</span><span class="btn-text-clone">' + escHTML(data.ctaText) + '</span></span></a></div>\n';
  }
  html += '      </div>\n';
  html += '      <div class="text-media-visual"></div>\n';
  html += '    </div>\n  </div>\n</section>';
  return html;
}

function buildListMediaHTML(data) {
  const invClass = data.inverted ? ' list-media-grid--inv' : '';
  let html = '<section class="list-media">\n  <div class="container">\n';
  html += '    <h2 class="list-media-heading">' + escHTML(data.heading) + '</h2>\n';
  html += '    <div class="list-media-grid' + invClass + '">\n';
  html += '      <div class="list-media-items">\n';
  data.items.forEach(item => {
    html += '        <div class="list-media-item">\n';
    html += '          <div class="list-media-item-title"><span class="list-media-item-indicator"></span>' + escHTML(item.title) + '</div>\n';
    html += '          <p class="list-media-item-desc">' + escHTML(item.desc) + '</p>\n';
    html += '        </div>\n';
  });
  html += '      </div>\n';
  html += '      <div class="list-media-visual"></div>\n';
  html += '    </div>\n  </div>\n</section>';
  return html;
}

function buildRelatedHTML(data) {
  let html = '<section class="related-section">\n  <div class="container">\n';
  html += '    <h2 class="related-heading">' + escHTML(data.heading) + '</h2>\n';
  html += '    <div class="related-grid">\n';
  data.cards.forEach(card => {
    html += '      <div class="related-card">\n';
    html += '        <div class="related-card-image"></div>\n';
    html += '        <h3 class="related-card-title">' + escHTML(card.title) + '</h3>\n';
    html += '        <p class="related-card-desc">' + escHTML(card.desc) + '</p>\n';
    if (card.ctaText) {
      html += '        <div><a href="#" class="btn btn-primary btn-md"><span class="btn-text-wrapper"><span class="btn-text">' + escHTML(card.ctaText) + '</span><span class="btn-text-clone">' + escHTML(card.ctaText) + '</span></span></a></div>\n';
    }
    html += '      </div>\n';
  });
  html += '    </div>\n  </div>\n</section>';
  return html;
}
function buildHeroHTML(data) {
  let html = '<section class="hero-section">\n';
  if (data.bgGlow) {
    html += '  <div class="hero-section-bg"><div class="hero-section-bg-blob"></div><div class="hero-section-bg-blob"></div><div class="hero-section-bg-blob"></div></div>\n';
  }
  html += '  <div class="hero-section-content">\n';
  if (data.badgeEnabled && (data.badgeTag || data.badgeText)) {
    html += '    <div class="hero-section-badge">';
    if (data.badgeTag) html += '<span class="hero-section-badge-new">' + escHTML(data.badgeTag) + '</span>';
    if (data.badgeText) html += '<span>' + escHTML(data.badgeText) + '</span>';
    html += '</div>\n';
  }
  html += '    <h1>' + escHTML(data.headline).replace(/\n/g, '<br>') + '</h1>\n';
  html += '    <p class="hero-section-subtitle">' + escHTML(data.subtitle) + '</p>\n';
  html += '    <div class="hero-section-actions">\n';
  if (data.primaryText) html += '      <a href="#" class="btn btn-primary btn-md"><span class="btn-text-wrapper"><span class="btn-text">' + escHTML(data.primaryText) + '</span><span class="btn-text-clone">' + escHTML(data.primaryText) + '</span></span></a>\n';
  if (data.secondaryText) html += '      <a href="#" class="btn btn-secondary btn-md"><span class="btn-text-wrapper"><span class="btn-text">' + escHTML(data.secondaryText) + '</span><span class="btn-text-clone">' + escHTML(data.secondaryText) + '</span></span></a>\n';
  html += '    </div>\n  </div>\n</section>';
  return html;
}

function buildSectionHTML(sec) {
  if (sec.type === 'statement') return buildStatementHTML(sec.data);
  if (sec.type === 'cta') return buildCtaHTML(sec.data);
  if (sec.type === 'hero') return buildHeroHTML(sec.data);
  if (sec.type === 'text-media') return buildTextMediaHTML(sec.data);
  if (sec.type === 'list-media') return buildListMediaHTML(sec.data);
  if (sec.type === 'related') return buildRelatedHTML(sec.data);
  return buildBentoHTML(sec.data);
}

// ==========================================================
//  RENDER: Section List (sidebar pills)
// ==========================================================

function renderSectionList() {
  const el = document.getElementById('sectionList');
  el.innerHTML = '';
  pageState.sections.forEach((sec, idx) => {
    const selected = sec.id === pageState.selectedId;
    const pill = document.createElement('div');
    pill.className = 'builder-section-pill' + (selected ? ' is-selected' : '');
    pill.innerHTML = `
      <span class="builder-section-pill-type">${SECTION_LABELS[sec.type]}</span>
      <span class="builder-section-pill-label">${escHTML(getSectionLabel(sec))}</span>
      <div class="builder-pill-actions">
        <button class="builder-pill-btn" title="Move up" onclick="event.stopPropagation();moveSection('${sec.id}',-1)">&#9650;</button>
        <button class="builder-pill-btn" title="Move down" onclick="event.stopPropagation();moveSection('${sec.id}',1)">&#9660;</button>
        <button class="builder-pill-btn is-danger" title="Delete" onclick="event.stopPropagation();deleteSection('${sec.id}')">&#10005;</button>
      </div>
    `;
    pill.addEventListener('click', () => selectSection(sec.id));
    el.appendChild(pill);
  });
}

function getSectionLabel(sec) {
  if (sec.type === 'statement') return sec.data.title.substring(0, 40);
  if (sec.type === 'cta') return sec.data.title.substring(0, 40);
  if (sec.type === 'hero') return sec.data.headline.replace(/\n/g, ' ').substring(0, 40);
  if (sec.type === 'text-media') return sec.data.title.substring(0, 40);
  if (sec.type === 'list-media') return sec.data.heading.substring(0, 40);
  if (sec.type === 'related') return sec.data.heading.substring(0, 40);
  return sec.data.heroTitle.replace(/\n/g, ' ').substring(0, 40);
}

// ==========================================================
//  RENDER: Page Preview
// ==========================================================

function renderPagePreview() {
  markDirty();
  const el = document.getElementById('pagePreview');
  let html = NAVBAR_HTML;
  html += '<div class="builder-sections-zone">';
  if (pageState.sections.length === 0) {
    html += '<div class="builder-empty"><div class="builder-empty-icon"><svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg></div><div class="builder-empty-text">Add a section to get started</div></div>';
  } else {
    pageState.sections.forEach((sec, idx) => {
      html += `<div class="builder-add-zone"><button class="builder-add-zone-btn" onclick="addSectionAt(${idx})">+</button></div>`;
      const selected = sec.id === pageState.selectedId;
      html += `<div class="builder-section-wrapper${selected ? ' is-selected' : ''}" data-id="${sec.id}" onclick="selectSection('${sec.id}')">`;
      html += `<span class="builder-section-label">${SECTION_LABELS[sec.type]}</span>`;
      html += buildSectionHTML(sec);
      html += '</div>';
    });
    html += `<div class="builder-add-zone"><button class="builder-add-zone-btn" onclick="addSectionAt(${pageState.sections.length})">+</button></div>`;
  }
  html += '</div>';
  html += FOOTER_HTML;
  el.innerHTML = html;
  initMegaMenu();
}

// ==========================================================
//  RENDER: Section Controls (contextual sidebar)
// ==========================================================

function renderSectionControls() {
  const el = document.getElementById('sectionControls');
  const sec = getSelected();
  if (!sec) { el.innerHTML = '<div style="font-size:12px;color:var(--text-tertiary);text-align:center;padding:var(--space-4)">Select a section to edit</div>'; return; }

  if (sec.type === 'statement') { renderStatementControls(el, sec); return; }
  if (sec.type === 'cta') { renderCtaControls(el, sec); return; }
  if (sec.type === 'hero') { renderHeroControls(el, sec); return; }
  if (sec.type === 'text-media') { renderTextMediaControls(el, sec); return; }
  if (sec.type === 'list-media') { renderListMediaControls(el, sec); return; }
  if (sec.type === 'related') { renderRelatedControls(el, sec); return; }
  renderBentoControls(el, sec);
}

function renderStatementControls(el, sec) {
  el.innerHTML = `
    <div class="builder-group">
      <div class="builder-group-title">Editing: Statement</div>
      <label class="builder-label">Title</label>
      <textarea class="builder-textarea" id="stmtTitle" rows="2" placeholder="Statement title">${escHTML(sec.data.title)}</textarea>
      <label class="builder-label" style="margin-top:8px">Body</label>
      <textarea class="builder-textarea" id="stmtBody" rows="3" placeholder="Statement body">${escHTML(sec.data.body)}</textarea>
    </div>
  `;
  document.getElementById('stmtTitle').addEventListener('input', e => { sec.data.title = e.target.value; renderPagePreview(); renderSectionList(); });
  document.getElementById('stmtBody').addEventListener('input', e => { sec.data.body = e.target.value; renderPagePreview(); });
}

function renderCtaControls(el, sec) {
  el.innerHTML = `
    <div class="builder-group">
      <div class="builder-group-title">Editing: CTA</div>
      <label class="builder-label">Title</label>
      <input class="builder-input" id="ctaTitle" type="text" value="${escAttr(sec.data.title)}" placeholder="CTA title">
      <label class="builder-label" style="margin-top:8px">Subtitle</label>
      <input class="builder-input" id="ctaSubtitle" type="text" value="${escAttr(sec.data.subtitle)}" placeholder="CTA subtitle">
      <label class="builder-label" style="margin-top:8px">Primary button</label>
      <input class="builder-input" id="ctaPrimary" type="text" value="${escAttr(sec.data.primaryText)}" placeholder="Primary button text">
      <label class="builder-label" style="margin-top:8px">Secondary button</label>
      <input class="builder-input" id="ctaSecondary" type="text" value="${escAttr(sec.data.secondaryText)}" placeholder="Secondary button text">
    </div>
  `;
  const bind = (id, key) => document.getElementById(id).addEventListener('input', e => { sec.data[key] = e.target.value; renderPagePreview(); renderSectionList(); });
  bind('ctaTitle', 'title'); bind('ctaSubtitle', 'subtitle'); bind('ctaPrimary', 'primaryText'); bind('ctaSecondary', 'secondaryText');
}

function renderBentoControls(el, sec) {
  const d = sec.data;
  const comp = d.composition;
  const cellCount = COMP_CELLS['bento-' + comp] || 0;
  const canInvert = comp === 'a';

  let cellsHTML = '';
  if (cellCount === 0) {
    cellsHTML = '<div style="font-size:12px;color:var(--text-tertiary)">No feature cells for 1x1.</div>';
  } else {
    for (let i = 0; i < cellCount && i < d.cells.length; i++) {
      const c = d.cells[i];
      let iconBtns = '';
      ICON_KEYS.forEach(key => {
        iconBtns += `<button class="builder-icon-btn ${c.icon === key ? 'is-active' : ''}" data-cell="${i}" data-icon="${key}" title="${key}">${ICONS[key]}</button>`;
      });
      cellsHTML += `<div class="builder-cell-group" style="margin-bottom:8px"><div class="builder-cell-header"><span class="builder-cell-num">Cell ${i+1}</span></div><div class="builder-cell-icon-picker" style="flex-wrap:wrap">${iconBtns}</div><input class="builder-input" data-cell="${i}" data-field="title" value="${escAttr(c.title)}" placeholder="Cell title"><input class="builder-input" data-cell="${i}" data-field="desc" value="${escAttr(c.desc)}" placeholder="Cell description"></div>`;
    }
  }

  el.innerHTML = `
    <div class="builder-group">
      <div class="builder-group-title">Editing: ${SECTION_LABELS[sec.type]}</div>
      <div class="builder-comp-grid" id="compPicker">
        <button class="builder-comp-btn ${comp==='a'?'is-active':''}" data-comp="a" title="A"><div class="builder-comp-icon"><div></div><div></div></div><span class="builder-comp-label">A</span></button>
        <button class="builder-comp-btn ${comp==='b'?'is-active':''}" data-comp="b" title="B"><div class="builder-comp-icon" style="flex-direction:column"><div></div><div style="flex:0.4"></div></div><span class="builder-comp-label">B</span></button>
        <button class="builder-comp-btn ${comp==='1x1'?'is-active':''}" data-comp="1x1" title="1x1"><div class="builder-comp-icon"><div></div></div><span class="builder-comp-label">1x1</span></button>
      </div>
    </div>
    <div class="builder-divider"></div>
    <div class="builder-group">
      <div class="builder-group-title">Hero Variant</div>
      <div class="builder-segment" id="heroVariant">
        <button class="builder-segment-btn ${d.heroVariant==='stacked'?'is-active':''}" data-variant="stacked">Stacked</button>
        <button class="builder-segment-btn ${d.heroVariant==='overlay'?'is-active':''}" data-variant="overlay">Overlay</button>
      </div>
    </div>
    <div class="builder-toggle-row" id="inversionRow" style="opacity:${canInvert?'1':'0.4'}">
      <span class="builder-toggle-label">Inverted</span>
      <label class="builder-toggle"><input type="checkbox" id="invertToggle" ${d.inverted?'checked':''} ${canInvert?'':'disabled'}><span class="builder-toggle-track"></span></label>
    </div>
    <div class="builder-toggle-row">
      <span class="builder-toggle-label">Animated</span>
      <label class="builder-toggle"><input type="checkbox" id="animatedToggle" ${d.animated?'checked':''}><span class="builder-toggle-track"></span></label>
    </div>
    <div class="builder-divider"></div>
    <div class="builder-group">
      <div class="builder-group-title">Section Context</div>
      <label class="builder-label">Tag label</label>
      <input class="builder-input" id="tagLabel" type="text" value="${escAttr(d.tagLabel)}" placeholder="e.g. PERFORMANCE">
      <label class="builder-label" style="margin-top:8px">Section title (optional)</label>
      <input class="builder-input" id="sectionTitle" type="text" value="${escAttr(d.sectionTitle)}" placeholder="Section title">
      <label class="builder-label" style="margin-top:8px">Section subtitle (optional)</label>
      <input class="builder-input" id="sectionSubtitle" type="text" value="${escAttr(d.sectionSubtitle)}" placeholder="Section subtitle">
    </div>
    <div class="builder-divider"></div>
    <div class="builder-group">
      <div class="builder-group-title">Hero Content</div>
      <label class="builder-label">Title</label>
      <textarea class="builder-textarea" id="heroTitle" rows="2">${escHTML(d.heroTitle)}</textarea>
      <label class="builder-label" style="margin-top:8px">Subtitle</label>
      <textarea class="builder-textarea" id="heroSubtitle" rows="2">${escHTML(d.heroSubtitle)}</textarea>
    </div>
    <div class="builder-divider"></div>
    <div class="builder-group">
      <div class="builder-toggle-row" style="padding:0">
        <span class="builder-group-title" style="margin:0">CTA Button</span>
        <label class="builder-toggle"><input type="checkbox" id="ctaToggle" ${d.ctaEnabled?'checked':''}><span class="builder-toggle-track"></span></label>
      </div>
      <input class="builder-input" id="ctaText" type="text" value="${escAttr(d.ctaText)}" placeholder="Button text">
    </div>
    <div class="builder-divider"></div>
    <div class="builder-group">
      <div class="builder-group-title">Feature Cells</div>
      <div id="cellsContainer">${cellsHTML}</div>
    </div>
  `;

  // Wire up bento controls
  const update = () => { renderPagePreview(); renderSectionList(); };
  const bindVal = (id, key) => { const e = document.getElementById(id); if (e) e.addEventListener('input', ev => { d[key] = ev.target.value; update(); }); };

  document.getElementById('compPicker').addEventListener('click', e => {
    const btn = e.target.closest('.builder-comp-btn');
    if (!btn) return;
    const newComp = btn.dataset.comp;
    d.composition = newComp;
    sec.type = 'bento-' + (newComp === '1x1' ? '1x1' : newComp);
    const needed = COMP_CELLS[sec.type] || 0;
    while (d.cells.length < needed) d.cells.push({ title: 'Feature title', desc: 'Feature description.', icon: ICON_KEYS[d.cells.length % ICON_KEYS.length] });
    renderSectionControls();
    update();
  });

  document.getElementById('heroVariant').addEventListener('click', e => {
    const btn = e.target.closest('.builder-segment-btn');
    if (!btn) return;
    d.heroVariant = btn.dataset.variant;
    document.querySelectorAll('#heroVariant .builder-segment-btn').forEach(b => b.classList.toggle('is-active', b === btn));
    renderPagePreview();
  });

  const inv = document.getElementById('invertToggle');
  if (inv) inv.addEventListener('change', e => { d.inverted = e.target.checked; renderPagePreview(); });
  const anim = document.getElementById('animatedToggle');
  if (anim) anim.addEventListener('change', e => { d.animated = e.target.checked; renderPagePreview(); });
  const ctaTog = document.getElementById('ctaToggle');
  if (ctaTog) ctaTog.addEventListener('change', e => { d.ctaEnabled = e.target.checked; renderPagePreview(); });

  bindVal('tagLabel', 'tagLabel');
  bindVal('sectionTitle', 'sectionTitle');
  bindVal('sectionSubtitle', 'sectionSubtitle');
  bindVal('heroTitle', 'heroTitle');
  bindVal('heroSubtitle', 'heroSubtitle');
  bindVal('ctaText', 'ctaText');

  // Cell editors
  const cc = document.getElementById('cellsContainer');
  if (cc) {
    cc.querySelectorAll('.builder-input').forEach(input => {
      input.addEventListener('input', e => {
        const idx = parseInt(e.target.dataset.cell);
        d.cells[idx][e.target.dataset.field] = e.target.value;
        renderPagePreview();
      });
    });
    cc.querySelectorAll('.builder-icon-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        const b = e.currentTarget;
        const idx = parseInt(b.dataset.cell);
        d.cells[idx].icon = b.dataset.icon;
        b.closest('.builder-cell-icon-picker').querySelectorAll('.builder-icon-btn').forEach(x => x.classList.remove('is-active'));
        b.classList.add('is-active');
        renderPagePreview();
      });
    });
  }
}


function renderHeroControls(el, sec) {
  const d = sec.data;
  el.innerHTML = `
    <div class="builder-group">
      <div class="builder-group-title">Editing: Hero</div>
      <label class="builder-label">Headline</label>
      <textarea class="builder-textarea" id="heroHeadline" rows="3">${escHTML(d.headline)}</textarea>
      <label class="builder-label" style="margin-top:8px">Subtitle</label>
      <textarea class="builder-textarea" id="heroSubtitleCtrl" rows="3">${escHTML(d.subtitle)}</textarea>
    </div>
    <div class="builder-divider"></div>
    <div class="builder-group">
      <div class="builder-toggle-row" style="padding:0">
        <span class="builder-group-title" style="margin:0">Announcement Badge</span>
        <label class="builder-toggle"><input type="checkbox" id="heroBadgeToggle" ${d.badgeEnabled?'checked':''}><span class="builder-toggle-track"></span></label>
      </div>
      <input class="builder-input" id="heroBadgeTag" type="text" value="${escAttr(d.badgeTag)}" placeholder="Badge tag (e.g. NEW)">
      <input class="builder-input" id="heroBadgeText" type="text" value="${escAttr(d.badgeText)}" placeholder="Badge text" style="margin-top:4px">
    </div>
    <div class="builder-divider"></div>
    <div class="builder-group">
      <div class="builder-group-title">Buttons</div>
      <label class="builder-label">Primary button</label>
      <input class="builder-input" id="heroPrimary" type="text" value="${escAttr(d.primaryText)}" placeholder="Primary button text">
      <label class="builder-label" style="margin-top:8px">Secondary button</label>
      <input class="builder-input" id="heroSecondary" type="text" value="${escAttr(d.secondaryText)}" placeholder="Secondary button text">
    </div>
    <div class="builder-divider"></div>
    <div class="builder-toggle-row">
      <span class="builder-toggle-label">Background glow</span>
      <label class="builder-toggle"><input type="checkbox" id="heroBgGlow" ${d.bgGlow?'checked':''}><span class="builder-toggle-track"></span></label>
    </div>
  `;
  const update = () => { renderPagePreview(); renderSectionList(); };
  const bind = (id, key) => document.getElementById(id).addEventListener('input', e => { d[key] = e.target.value; update(); });
  bind('heroHeadline', 'headline'); bind('heroSubtitleCtrl', 'subtitle');
  bind('heroBadgeTag', 'badgeTag'); bind('heroBadgeText', 'badgeText');
  bind('heroPrimary', 'primaryText'); bind('heroSecondary', 'secondaryText');
  document.getElementById('heroBadgeToggle').addEventListener('change', e => { d.badgeEnabled = e.target.checked; renderPagePreview(); });
  document.getElementById('heroBgGlow').addEventListener('change', e => { d.bgGlow = e.target.checked; renderPagePreview(); });
}

function renderTextMediaControls(el, sec) {
  const d = sec.data;
  el.innerHTML = `
    <div class="builder-group">
      <div class="builder-group-title">Editing: Text + Media</div>
      <label class="builder-label">Tag label</label>
      <input class="builder-input" id="tmTag" type="text" value="${escAttr(d.tagLabel)}" placeholder="e.g. LOREM IPSUM">
      <label class="builder-label" style="margin-top:8px">Title</label>
      <textarea class="builder-textarea" id="tmTitle" rows="2">${escHTML(d.title)}</textarea>
      <label class="builder-label" style="margin-top:8px">Subtitle</label>
      <textarea class="builder-textarea" id="tmSubtitle" rows="3">${escHTML(d.subtitle)}</textarea>
    </div>
    <div class="builder-divider"></div>
    <div class="builder-toggle-row">
      <span class="builder-toggle-label">Inverted (Media first)</span>
      <label class="builder-toggle"><input type="checkbox" id="tmInvert" ${d.inverted?'checked':''}><span class="builder-toggle-track"></span></label>
    </div>
    <div class="builder-divider"></div>
    <div class="builder-group">
      <div class="builder-toggle-row" style="padding:0">
        <span class="builder-group-title" style="margin:0">CTA Button</span>
        <label class="builder-toggle"><input type="checkbox" id="tmCtaToggle" ${d.ctaEnabled?'checked':''}><span class="builder-toggle-track"></span></label>
      </div>
      <input class="builder-input" id="tmCtaText" type="text" value="${escAttr(d.ctaText)}" placeholder="Button text">
    </div>
  `;
  const update = () => { renderPagePreview(); renderSectionList(); };
  const bind = (id, key) => document.getElementById(id).addEventListener('input', e => { d[key] = e.target.value; update(); });
  bind('tmTag', 'tagLabel'); bind('tmTitle', 'title'); bind('tmSubtitle', 'subtitle'); bind('tmCtaText', 'ctaText');
  document.getElementById('tmInvert').addEventListener('change', e => { d.inverted = e.target.checked; renderPagePreview(); });
  document.getElementById('tmCtaToggle').addEventListener('change', e => { d.ctaEnabled = e.target.checked; renderPagePreview(); });
}

function renderListMediaControls(el, sec) {
  const d = sec.data;
  let itemsHTML = '';
  d.items.forEach((item, i) => {
    itemsHTML += `<div class="builder-cell-group" style="margin-bottom:8px"><div class="builder-cell-header"><span class="builder-cell-num">Item ${i+1}</span><button class="builder-pill-btn is-danger" data-remove="${i}" title="Remove">&#10005;</button></div><input class="builder-input" data-item="${i}" data-field="title" value="${escAttr(item.title)}" placeholder="Item title"><input class="builder-input" data-item="${i}" data-field="desc" value="${escAttr(item.desc)}" placeholder="Item description"></div>`;
  });
  el.innerHTML = `
    <div class="builder-group">
      <div class="builder-group-title">Editing: List + Media</div>
      <label class="builder-label">Section heading</label>
      <textarea class="builder-textarea" id="lmHeading" rows="2">${escHTML(d.heading)}</textarea>
    </div>
    <div class="builder-toggle-row">
      <span class="builder-toggle-label">Inverted (Media first)</span>
      <label class="builder-toggle"><input type="checkbox" id="lmInvert" ${d.inverted?'checked':''}><span class="builder-toggle-track"></span></label>
    </div>
    <div class="builder-divider"></div>
    <div class="builder-group">
      <div class="builder-group-title">List Items</div>
      <div id="lmItemsContainer">${itemsHTML}</div>
      <button class="builder-add-section-btn" onclick="addListMediaItem('${sec.id}')">+ Add Item</button>
    </div>
  `;
  const update = () => { renderPagePreview(); renderSectionList(); };
  document.getElementById('lmHeading').addEventListener('input', e => { d.heading = e.target.value; update(); });
  document.getElementById('lmInvert').addEventListener('change', e => { d.inverted = e.target.checked; renderPagePreview(); });
  const cc = document.getElementById('lmItemsContainer');
  cc.querySelectorAll('.builder-input').forEach(input => {
    input.addEventListener('input', e => {
      const idx = parseInt(e.target.dataset.item);
      d.items[idx][e.target.dataset.field] = e.target.value;
      renderPagePreview();
    });
  });
  cc.querySelectorAll('[data-remove]').forEach(btn => {
    btn.addEventListener('click', e => {
      const idx = parseInt(e.currentTarget.dataset.remove);
      if (d.items.length > 1) { d.items.splice(idx, 1); renderListMediaControls(el, sec); renderPagePreview(); renderSectionList(); }
    });
  });
}

function addListMediaItem(secId) {
  const sec = pageState.sections.find(s => s.id === secId);
  if (!sec) return;
  sec.data.items.push({ title: 'Lorem Ipsum', desc: 'ornare sem cursus in non. Tellus lacus augue vulputate dui. Porta.' });
  renderSectionControls();
  renderPagePreview();
}

function renderRelatedControls(el, sec) {
  const d = sec.data;
  let cardsHTML = '';
  d.cards.forEach((card, i) => {
    cardsHTML += `<div class="builder-cell-group" style="margin-bottom:8px"><div class="builder-cell-header"><span class="builder-cell-num">Card ${i+1}</span><button class="builder-pill-btn is-danger" data-remove="${i}" title="Remove">&#10005;</button></div><input class="builder-input" data-card="${i}" data-field="title" value="${escAttr(card.title)}" placeholder="Card title"><input class="builder-input" data-card="${i}" data-field="desc" value="${escAttr(card.desc)}" placeholder="Card description"><input class="builder-input" data-card="${i}" data-field="ctaText" value="${escAttr(card.ctaText)}" placeholder="CTA button text"></div>`;
  });
  el.innerHTML = `
    <div class="builder-group">
      <div class="builder-group-title">Editing: Related</div>
      <label class="builder-label">Section heading</label>
      <input class="builder-input" id="relHeading" type="text" value="${escAttr(d.heading)}" placeholder="Section heading">
    </div>
    <div class="builder-divider"></div>
    <div class="builder-group">
      <div class="builder-group-title">Cards</div>
      <div id="relCardsContainer">${cardsHTML}</div>
      <button class="builder-add-section-btn" onclick="addRelatedCard('${sec.id}')">+ Add Card</button>
    </div>
  `;
  const update = () => { renderPagePreview(); renderSectionList(); };
  document.getElementById('relHeading').addEventListener('input', e => { d.heading = e.target.value; update(); });
  const cc = document.getElementById('relCardsContainer');
  cc.querySelectorAll('.builder-input').forEach(input => {
    input.addEventListener('input', e => {
      const idx = parseInt(e.target.dataset.card);
      d.cards[idx][e.target.dataset.field] = e.target.value;
      renderPagePreview();
    });
  });
  cc.querySelectorAll('[data-remove]').forEach(btn => {
    btn.addEventListener('click', e => {
      const idx = parseInt(e.currentTarget.dataset.remove);
      if (d.cards.length > 1) { d.cards.splice(idx, 1); renderRelatedControls(el, sec); renderPagePreview(); renderSectionList(); }
    });
  });
}

function addRelatedCard(secId) {
  const sec = pageState.sections.find(s => s.id === secId);
  if (!sec) return;
  sec.data.cards.push({ title: 'New card', desc: 'Card description goes here.', ctaText: 'CTA Button' });
  renderSectionControls();
  renderPagePreview();
}

// ==========================================================
//  SECTION MANAGEMENT
// ==========================================================

function addSection(type) {
  const sec = createSection(type);
  pageState.sections.push(sec);
  pageState.selectedId = sec.id;
  document.getElementById('typePicker').classList.remove('is-open');
  markDirty();
  renderAll();
}

function addSectionAt(idx) {
  // Show a simple picker — for now just add a bento-a
  const sec = createSection('bento-a');
  pageState.sections.splice(idx, 0, sec);
  pageState.selectedId = sec.id;
  markDirty();
  renderAll();
}

function selectSection(id) {
  pageState.selectedId = id;
  renderSectionList();
  renderSectionControls();
  // Update preview selection highlight
  document.querySelectorAll('.builder-section-wrapper').forEach(w => {
    w.classList.toggle('is-selected', w.dataset.id === id);
  });
}

function moveSection(id, dir) {
  const idx = pageState.sections.findIndex(s => s.id === id);
  const newIdx = idx + dir;
  if (newIdx < 0 || newIdx >= pageState.sections.length) return;
  const [sec] = pageState.sections.splice(idx, 1);
  pageState.sections.splice(newIdx, 0, sec);
  markDirty();
  renderAll();
}

function deleteSection(id) {
  pageState.sections = pageState.sections.filter(s => s.id !== id);
  if (pageState.selectedId === id) pageState.selectedId = pageState.sections.length ? pageState.sections[0].id : null;
  markDirty();
  renderAll();
}

function toggleTypePicker() {
  document.getElementById('typePicker').classList.toggle('is-open');
}

// ==========================================================
//  EXPORT
// ==========================================================

function exportHTML() {
  let html = '';
  if (pageState.exportScope === 'full') {
    html += NAVBAR_HTML + '\n\n';
  }
  pageState.sections.forEach(sec => {
    html += buildSectionHTML(sec) + '\n\n';
  });
  if (pageState.exportScope === 'full') {
    html += FOOTER_HTML + '\n';
  }
  navigator.clipboard.writeText(html).then(() => {
    const btn = document.getElementById('exportBtn');
    const txt = document.getElementById('exportBtnText');
    btn.classList.add('is-copied');
    txt.textContent = 'Copied!';
    setTimeout(() => { btn.classList.remove('is-copied'); txt.textContent = 'Copy HTML'; }, 2000);
  });
}

// Scope toggle
document.getElementById('scopeToggle').addEventListener('click', e => {
  const btn = e.target.closest('.builder-scope-btn');
  if (!btn) return;
  pageState.exportScope = btn.dataset.scope;
  document.querySelectorAll('.builder-scope-btn').forEach(b => b.classList.toggle('is-active', b === btn));
});

// ==========================================================
//  MEGA MENU (for preview)
// ==========================================================

function initMegaMenu() {
  const mega = document.getElementById('megaMenu');
  if (!mega) return;
  const panels = mega.querySelectorAll('.mega-menu-panel');
  const buttons = document.querySelectorAll('.builder-page-preview .navbar-links [data-menu]');
  let hideTimeout;
  function showPanel(name) {
    clearTimeout(hideTimeout);
    panels.forEach(p => p.classList.toggle('is-visible', p.dataset.panel === name));
    mega.classList.add('is-visible');
  }
  function startHide() {
    hideTimeout = setTimeout(() => { mega.classList.remove('is-visible'); panels.forEach(p => p.classList.remove('is-visible')); }, 120);
  }
  buttons.forEach(btn => { btn.addEventListener('mouseenter', () => showPanel(btn.dataset.menu)); btn.addEventListener('mouseleave', startHide); });
  mega.addEventListener('mouseenter', () => clearTimeout(hideTimeout));
  mega.addEventListener('mouseleave', startHide);
}

// ==========================================================
//  PROTOTYPES — hybrid persistence (file API → localStorage)
// ==========================================================

const PROTO_STORAGE_KEY = 'gladia-builder-prototypes';
let _protosCache = [];
let _hasFileApi = false;
let _suppressDirty = false;

function loadPrototypes() {
  return _protosCache;
}

function savePrototypes(protos) {
  _protosCache = protos;
  localStorage.setItem(PROTO_STORAGE_KEY, JSON.stringify(protos));
  if (_hasFileApi) {
    fetch('/api/prototypes', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(protos),
    }).catch(() => {});
  }
}

async function fetchPrototypes() {
  try {
    const res = await fetch('/api/prototypes');
    if (res.ok) {
      _protosCache = await res.json();
      _hasFileApi = true;
      localStorage.setItem(PROTO_STORAGE_KEY, JSON.stringify(_protosCache));
      return;
    }
  } catch {}
  try { _protosCache = JSON.parse(localStorage.getItem(PROTO_STORAGE_KEY)) || []; }
  catch { _protosCache = []; }
}

function markDirty() {
  if (_suppressDirty) return;
  if (!pageState.dirty) {
    pageState.dirty = true;
    updateUnsavedDot();
  }
}

function updateUnsavedDot() {
  const dot = document.getElementById('protoUnsavedDot');
  if (dot) dot.classList.toggle('is-visible', pageState.dirty);
}

function saveCurrentProto() {
  const protos = loadPrototypes();
  if (pageState.activeProtoId) {
    const idx = protos.findIndex(p => p.id === pageState.activeProtoId);
    if (idx !== -1) {
      protos[idx].sections = JSON.parse(JSON.stringify(pageState.sections));
      protos[idx].secCounter = secCounter;
      protos[idx].updatedAt = new Date().toISOString();
      savePrototypes(protos);
      pageState.dirty = false;
      updateUnsavedDot();
      flashSaveBtn();
      renderProtoDrawer();
      return;
    }
  }
  const name = prompt('Name your prototype:', 'Prototype ' + (protos.length + 1));
  if (!name) return;
  const proto = {
    id: 'proto_' + Date.now(),
    name: name,
    updatedAt: new Date().toISOString(),
    sections: JSON.parse(JSON.stringify(pageState.sections)),
    secCounter: secCounter,
  };
  protos.unshift(proto);
  savePrototypes(protos);
  pageState.activeProtoId = proto.id;
  pageState.dirty = false;
  updateUnsavedDot();
  flashSaveBtn();
  renderProtoDrawer();
}

function flashSaveBtn() {
  const btn = document.getElementById('protoSaveBtn');
  const txt = document.getElementById('protoSaveBtnText');
  btn.classList.add('is-saved');
  txt.textContent = 'Saved!';
  setTimeout(() => { btn.classList.remove('is-saved'); txt.textContent = 'Save'; }, 1500);
}

function loadProto(id) {
  const protos = loadPrototypes();
  const proto = protos.find(p => p.id === id);
  if (!proto) return;
  _suppressDirty = true;
  pageState.sections = JSON.parse(JSON.stringify(proto.sections));
  pageState.selectedId = pageState.sections.length ? pageState.sections[0].id : null;
  pageState.activeProtoId = proto.id;
  pageState.dirty = false;
  secCounter = proto.secCounter || pageState.sections.length;
  updateUnsavedDot();
  renderAll();
  _suppressDirty = false;
  renderProtoDrawer();
}

function deleteProto(id) {
  if (!confirm('Delete this prototype?')) return;
  let protos = loadPrototypes();
  protos = protos.filter(p => p.id !== id);
  savePrototypes(protos);
  if (pageState.activeProtoId === id) {
    pageState.activeProtoId = null;
    pageState.dirty = false;
    updateUnsavedDot();
  }
  renderProtoDrawer();
}

function duplicateProto(id) {
  const protos = loadPrototypes();
  const proto = protos.find(p => p.id === id);
  if (!proto) return;
  const dup = {
    id: 'proto_' + Date.now(),
    name: proto.name + ' (copy)',
    updatedAt: new Date().toISOString(),
    sections: JSON.parse(JSON.stringify(proto.sections)),
    secCounter: proto.secCounter,
  };
  protos.unshift(dup);
  savePrototypes(protos);
  renderProtoDrawer();
}

function renameProto(id, newName) {
  const protos = loadPrototypes();
  const proto = protos.find(p => p.id === id);
  if (!proto || !newName.trim()) return;
  proto.name = newName.trim();
  proto.updatedAt = new Date().toISOString();
  savePrototypes(protos);
  renderProtoDrawer();
}

function toggleProtoDrawer() {
  const drawer = document.getElementById('protoDrawer');
  const backdrop = document.getElementById('protoBackdrop');
  const isOpen = drawer.classList.contains('is-open');
  drawer.classList.toggle('is-open', !isOpen);
  backdrop.classList.toggle('is-open', !isOpen);
  if (!isOpen) renderProtoDrawer();
}

function renderProtoDrawer() {
  const body = document.getElementById('protoDrawerBody');
  if (!body) return;
  const protos = loadPrototypes();
  let html = '<button class="proto-new-btn" onclick="newProtoFromDrawer()">+ New Prototype</button>';
  if (protos.length === 0) {
    html += '<div class="proto-empty"><div class="proto-empty-icon">&#128193;</div><div class="proto-empty-text">No saved prototypes yet.<br>Build something and hit Save!</div></div>';
  } else {
    protos.forEach(p => {
      const isActive = p.id === pageState.activeProtoId;
      const date = new Date(p.updatedAt);
      const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      const secCount = (p.sections || []).length;
      html += `<div class="proto-item${isActive ? ' is-active' : ''}">`;
      html += `<div class="proto-item-top"><span class="proto-item-dot"></span><span class="proto-item-name" ondblclick="startRenameProto(this, '${p.id}')">${escHTML(p.name)}</span></div>`;
      html += `<div class="proto-item-meta">${dateStr} &middot; ${secCount} section${secCount !== 1 ? 's' : ''}</div>`;
      html += `<div class="proto-item-actions">`;
      html += `<button class="proto-item-btn" onclick="loadProto('${p.id}')">Load</button>`;
      html += `<button class="proto-item-btn" onclick="duplicateProto('${p.id}')">Duplicate</button>`;
      html += `<button class="proto-item-btn is-danger" onclick="deleteProto('${p.id}')">Delete</button>`;
      html += `</div></div>`;
    });
  }
  body.innerHTML = html;
}

function startRenameProto(nameEl, id) {
  const current = nameEl.textContent;
  const input = document.createElement('input');
  input.type = 'text';
  input.className = 'proto-item-name-input';
  input.value = current;
  nameEl.replaceWith(input);
  input.focus();
  input.select();
  function commit() {
    renameProto(id, input.value || current);
  }
  input.addEventListener('blur', commit);
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') { e.preventDefault(); input.blur(); }
    if (e.key === 'Escape') { input.value = current; input.blur(); }
  });
}

function newProtoFromDrawer() {
  const name = prompt('Name your prototype:', 'Prototype ' + (loadPrototypes().length + 1));
  if (!name) return;
  _suppressDirty = true;
  pageState.sections = [];
  pageState.selectedId = null;
  secCounter = 0;
  const proto = {
    id: 'proto_' + Date.now(),
    name: name,
    updatedAt: new Date().toISOString(),
    sections: [],
    secCounter: 0,
  };
  const protos = loadPrototypes();
  protos.unshift(proto);
  savePrototypes(protos);
  pageState.activeProtoId = proto.id;
  pageState.dirty = false;
  updateUnsavedDot();
  renderAll();
  _suppressDirty = false;
  renderProtoDrawer();
}

// Auto-save on page unload
window.addEventListener('beforeunload', () => {
  if (pageState.activeProtoId && pageState.dirty) {
    const protos = loadPrototypes();
    const idx = protos.findIndex(p => p.id === pageState.activeProtoId);
    if (idx !== -1) {
      protos[idx].sections = JSON.parse(JSON.stringify(pageState.sections));
      protos[idx].secCounter = secCounter;
      protos[idx].updatedAt = new Date().toISOString();
      _protosCache = protos;
      localStorage.setItem(PROTO_STORAGE_KEY, JSON.stringify(protos));
      if (_hasFileApi) {
        navigator.sendBeacon('/api/prototypes', new Blob([JSON.stringify(protos)], { type: 'application/json' }));
      }
    }
  }
});

// ==========================================================
//  RENDER ALL
// ==========================================================

function renderAll() {
  renderSectionList();
  renderPagePreview();
  renderSectionControls();
}

// ==========================================================
//  INIT
// ==========================================================

(async () => {
  await fetchPrototypes();
  _suppressDirty = true;
  renderAll();
  _suppressDirty = false;
})();
</script>
</body>
</html>
